(function(){var M=YAHOO.util.Dom,K=YAHOO.util.Event;var J=Alfresco.util.encodeHTML,E=Alfresco.util.combinePaths,D=Alfresco.util.siteURL,P=Alfresco.util.isValueSet;var i;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function w(X,W){var Y=W[1];if(Y&&P(Y.actionName)&&P(Y.fn)){this.registerAction(Y.actionName,Y.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+Y)}},registerAction:function c(W,X){if(P(W)&&P(X)){this.constructor.prototype[W]=X;return true}return false},renderAction:function O(X,aa){var W=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",ac='style="background-image:url('+W+'{icon}-16.png)" ',Z={link:'<div class="{id}"><a title="{label}" class="simple-link" href="{href}" '+ac+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}"><a title="{label}" class="simple-link" href="{pageUrl}" '+ac+"><span>{label}</span></a></div>",javascript:'<div class="{id}" title="{jsfunction}"><a title="{label}" class="action-link" href="#"'+ac+"><span>{label}</span></a></div>"};aa.actionParams[X.id]=X.params;var Y={id:X.id,icon:X.icon,label:J(Alfresco.util.substituteDotNotation(this.msg(X.label),aa))};if(X.type==="link"){if(X.params.href){Y.href=Alfresco.util.substituteDotNotation(X.params.href,aa);Y.target=X.params.target?'target="'+X.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",X.id)}}else{if(X.type==="pagelink"){if(X.params.page){Y.pageUrl=Alfresco.util.substituteDotNotation(X.params.page,aa);if(X.params.page.charAt(0)!=="{"){var ab=P(aa.location.site)?aa.location.site.name:null;Y.pageUrl=D(Y.pageUrl,{site:ab})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",X.id)}}else{if(X.type==="javascript"){if(X.params["function"]){Y.jsfunction=X.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",X.id)}}}}return YAHOO.lang.substitute(Z[X.type],Y)},getActionUrls:function t(ac,X){var Z=ac.jsNode,af=Z.isLink?Z.linkedNode.nodeRef:Z.nodeRef,ad=af.toString(),W=af.uri,ab=Z.contentURL,ag=ac.workingCopy||{},Y=P(ac.location.site)?ac.location.site.name:null,ae=Alfresco.util.bind(function(ah){return Alfresco.util.siteURL(ah,{site:YAHOO.lang.isString(X)?X:Y})},this),aa={downloadUrl:E(Alfresco.constants.PROXY_URI,ab)+"?a=true",viewUrl:E(Alfresco.constants.PROXY_URI,ab)+'" target="_blank',documentDetailsUrl:ae("document-details?nodeRef="+ad),folderDetailsUrl:ae("folder-details?nodeRef="+ad),editMetadataUrl:ae("edit-metadata?nodeRef="+ad),inlineEditUrl:ae("inline-edit?nodeRef="+ad),managePermissionsUrl:ae("manage-permissions?nodeRef="+ad),manageTranslationsUrl:ae("manage-translations?nodeRef="+ad),workingCopyUrl:ae("document-details?nodeRef="+(ag.workingCopyNodeRef||ad)),workingCopySourceUrl:ae("document-details?nodeRef="+(ag.sourceNodeRef||ad)),viewGoogleDocUrl:ag.googleDocUrl+'" target="_blank',explorerViewUrl:E(this.options.repositoryUrl,"/n/showSpaceDetails/",W)+'" target="_blank',cloudViewUrl:E(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+ad)};aa.sourceRepositoryUrl=this.viewInSourceRepositoryURL(ac,aa)+'" target="_blank';return aa},getAction:function V(X,W,ab){var ad=W.className,aa=Alfresco.util.findInArray(X.actions,ad,"id")||{};if(ab===false){return aa}else{aa=Alfresco.util.deepCopy(aa);var ac=aa.params||{};for(var Y in ac){ac[Y]=YAHOO.lang.substitute(ac[Y],X,function Z(af,ag,ae){return Alfresco.util.findValueByDotNotation(X,af)})}return aa}},getParentNodeRef:function U(X){var aa=null;if(YAHOO.lang.isArray(X)){try{aa=this.doclistMetadata.parent.nodeRef}catch(ab){aa=null}if(aa===null){for(var Z=1,Y=X.length,W=true;Z<Y&&W;Z++){W=(X[Z].parent.nodeRef==X[Z-1].parent.nodeRef)}aa=W?X[0].parent.nodeRef:this.doclistMetadata.container}}else{aa=X.parent.nodeRef}return aa},onActionDetails:function F(Z){var af=this,ab=Z.nodeRef,Y=Z.jsNode;var ad=function W(ah,ai){var ag='<span class="light">'+J(Z.displayName)+"</span>";Alfresco.util.populateHTML([ai.id+"-dialogTitle",af.msg("edit-details.title",ag)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(ai,"editMetadata",null,{type:"link",label:af.msg("edit-details.label.edit-metadata"),href:D("edit-metadata?nodeRef="+ab)})};var X=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:ab,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ae=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ae.setOptions({width:"40em",templateUrl:X,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:ad,scope:this},onSuccess:{fn:function aa(ah){Alfresco.util.Ajax.request({url:E(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/node/",Y.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function ai(ak){var aj=ak.json.item;aj.jsNode=new Alfresco.util.Node(ak.json.item.node);YAHOO.Bubbling.fire(aj.node.isContainer?"folderRenamed":"fileRenamed",{file:aj});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function ag(aj){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function ac(ag){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}}).show()},onActionLocate:function T(W){var Y=W.jsNode,aa=W.location.path,X=Y.isLink?Y.linkedNode.properties.name:W.displayName,Z=P(W.location.site)?W.location.site.name:null;if(P(this.options.siteId)&&Z!==this.options.siteId){window.location=D((Z===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(X)+"&path="+encodeURIComponent(aa),{site:Z})}else{this.options.highlightFile=X;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:aa})}},onActionDelete:function N(Y){var ac=this,W=Y.jsNode,ab=W.isContainer?"folder":"document",ad=Y.displayName,X=(this.options.syncMode==="CLOUD");var ae=this.msg("message.confirm.delete",ad);if(W.hasAspect("sync:syncSetMemberNode")){if(X){ae+=this.msg("actions.synced.cloud."+ab+".delete",ad)}else{ae+=this.msg("actions.synced."+ab+".delete",ad)}}Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ab+".delete"),text:ae,noEscape:true,buttons:[{text:this.msg("button.delete"),handler:function aa(){this.destroy();ac._onActionDeleteConfirm.call(ac,Y)}},{text:this.msg("button.cancel"),handler:function Z(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function R(X){var aa=X.jsNode,ab=X.location.path,ac=X.location.file,Y=E(ab,ac),W=X.displayName,Z=aa.nodeRef;this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:"file-deleted",page:"documentlibrary",activityData:{fileName:ac,path:ab,nodeRef:Z.toString()}},event:{name:aa.isContainer?"folderDeleted":"fileDeleted",obj:{path:Y}},message:this.msg("message.delete.success",W)},failure:{message:this.msg("message.delete.failure",W)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:Z.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(W){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing"},onActionEditOnline:function n(W){if(this._launchOnlineEditor(W)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}},_launchOnlineEditor:function z(aa){var ad="SharePoint.OpenDocuments",X=aa.jsNode,ab=aa.location,ae=X.mimetype,Y=null,Z=null,W={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(this.onlineEditMimetypes.hasOwnProperty(ae)){Y=this.onlineEditMimetypes[ae]}else{var ac=Alfresco.util.getFileExtension(aa.location.file);if(ac!==null){ac=ac.toLowerCase();if(W.hasOwnProperty(ac)){ae=W[ac];if(this.onlineEditMimetypes.hasOwnProperty(ae)){Y=this.onlineEditMimetypes[ae]}}}}if(Y!==null){if(!P(aa.onlineEditUrl)){aa.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ab)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(ad,aa,Y)}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(aa,Y)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",ab.file)});return false}}return window.open(aa.onlineEditUrl,"_blank")},_launchOnlineEditorIE:function G(Y,W,X){try{if(X==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(Y+".3");return activeXControl.EditDocument3(window,W.onlineEditUrl,true,X)}catch(aa){try{activeXControl=new ActiveXObject(Y+".2");return activeXControl.EditDocument2(window,W.onlineEditUrl,X)}catch(ab){try{activeXControl=new ActiveXObject(Y+".1");return activeXControl.EditDocument(W.onlineEditUrl,X)}catch(Z){}}}return false},_launchOnlineEditorPlugin:function g(X,Y){var Z=document.getElementById("SharePointPlugin");if(Z==null&&Alfresco.util.isSharePointPluginInstalled()){var W=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){W="application/x-sharepoint-webkit"}else{W="application/x-sharepoint"}var ad=document.createElement("object");ad.id="SharePointPlugin";ad.type=W;ad.width=0;ad.height=0;ad.style.setProperty("visibility","hidden","");document.body.appendChild(ad);Z=document.getElementById("SharePointPlugin");if(!Z){return false}}try{if(Y==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return Z.EditDocument3(window,X.onlineEditUrl,true,Y)}catch(ab){try{return Z.EditDocument2(window,X.onlineEditUrl,Y)}catch(ac){try{return Z.EditDocument(X.onlineEditUrl,Y)}catch(aa){return false}}}},onActionCheckoutToGoogleDocs:function f(W){Alfresco.logger.error("onActionCheckoutToGoogleDocs","Abstract implementation not overridden")},onActionCheckinFromGoogleDocs:function v(W){Alfresco.logger.error("onActionCheckinFromGoogleDocs","Abstract implementation not overridden")},onActionSimpleRepoAction:function e(Y,W){var aa=this.getAction(Y,W).params,X=Y.displayName;var Z={success:{event:{name:"metadataRefresh",obj:Y}},failure:{message:this.msg(aa.failureMessage,X)},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:Y.nodeRef,actionDefinitionName:aa.action}}};if(YAHOO.lang.isFunction(this[aa.success])){Z.success.callback={fn:this[aa.success],obj:Y,scope:this}}if(aa.successMessage){Z.success.message=this.msg(aa.successMessage,X)}if(YAHOO.lang.isFunction(this[aa.failure])){Z.failure.callback={fn:this[aa.failure],obj:Y,scope:this}}if(aa.failureMessage){Z.failure.message=this.msg(aa.failureMessage,X)}this.modules.actions.genericAction(Z)},onActionFormDialog:function o(Y,W){var aa=this.getAction(Y,W),ac=aa.params,Z={title:this.msg(aa.label)},X=Y.displayName;delete ac["function"];var ab=ac.success;delete ac.success;Z.success={fn:function(ad,ae){if(YAHOO.lang.isFunction(this[ab])){this[ab].call(this,ad,ae)}YAHOO.Bubbling.fire("metadataRefresh",ae)},obj:Y,scope:this};if(ac.successMessage){Z.successMessage=this.msg(ac.successMessage,X);delete ac.successMessage}if(YAHOO.lang.isFunction(this[ac.failure])){Z.failure={fn:this[ac.failure],obj:Y,scope:this};delete ac.failure}if(ac.failureMessage){Z.failureMessage=this.msg(ac.failureMessage,X);delete ac.failureMessage}Z.properties=ac;Alfresco.util.PopupManager.displayForm(Z)},onActionUploadNewVersion:function m(Y){var ad=Y.jsNode,X=Y.displayName,aa=ad.nodeRef,W=Y.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ac=this.msg("label.filter-description",X),Z="*";if(X&&new RegExp(/[^\.]+\.[^\.]+/).exec(X)){Z="*"+X.substring(X.lastIndexOf("."))}if(Y.workingCopy&&Y.workingCopy.workingCopyVersion){W=Y.workingCopy.workingCopyVersion}var ab={updateNodeRef:aa.toString(),updateFilename:X,updateVersion:W,overwrite:true,filter:[{description:ac,extensions:Z}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};if(P(this.options.siteId)){ab.siteId=this.options.siteId;ab.containerId=this.options.containerId}this.fileUpload.show(ab)},_uploadComplete:function L(W,aa){var ab=W.successful.length,X,Z;if(ab>0){if(ab<(this.options.groupActivitiesAt||5)){for(var Y=0;Y<ab;Y++){Z=W.successful[Y];X={fileName:Z.fileName,nodeRef:Z.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+aa,"document-details",X)}}else{X={fileCount:ab,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+aa,"documentlibrary",X)}}},onFileUploadComplete:function q(W){this._uploadComplete(W,"added")},onNewVersionUploadComplete:function x(W){this._uploadComplete(W,"updated")},onActionCancelEditing:function k(X){var W=X.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",W)},failure:{message:this.msg("message.edit-cancel.failure",W)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:X.jsNode.nodeRef.uri}}})},onActionCopyTo:function j(W){this._copyMoveTo("copy",W)},onActionMoveTo:function h(W){this._copyMoveTo("move",W)},_copyMoveTo:function C(Y,X){if(!Y in {copy:true,move:true}){throw new Error("'"+Y+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var W=[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE];if(this.options.repositoryBrowsing===true){W.push(Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME)}this.modules.copyMoveTo.setOptions({allowedViewModes:W,mode:Y,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:X,rootNode:this.options.rootNode,parentId:this.getParentNodeRef(X)}).showDialog()},onActionAssignWorkflow:function d(X){var ab="",W=this.getParentNodeRef(X);if(YAHOO.lang.isArray(X)){for(var Z=0,Y=X.length;Z<Y;Z++){ab+=(Z===0?"":",")+X[Z].nodeRef}}else{ab=X.nodeRef}var aa={selectedItems:ab};if(W){aa.destination=W}Alfresco.util.navigateTo(D("start-workflow"),"POST",aa)},onActionManagePermissions:function I(W){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:W}).showDialog()},onActionManageAspects:function s(W){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:W}).show()},onActionChangeType:function r(aa){var W=aa.jsNode,ab=W.type,ad=aa.displayName,X=Alfresco.constants.PROXY_URI+E("slingshot/doclib/type/node",W.nodeRef.uri);var ae=function Z(ag){ag.addValidation(this.id+"-changeType-type",function af(am,ai,al,ak,ah,aj){return am.options[am.selectedIndex].value!=="-"},null,"change");ag.setShowSubmitStateDynamically(true,false)};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(ab),actionUrl:X,doSetupFormsValidation:{fn:ae,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function ac(af){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:ad});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",ad)})},scope:this},onFailure:{fn:function Y(af){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",ad)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function p(Y,aa){var Z=Y.node,X=Y.location.repositoryId,W=this.options.replicationUrlMapping,ab;if(!X||!W||!W[X]){return"#"}ab=Z.isContainer?aa.folderDetailsUrl:aa.documentDetailsUrl;ab=ab.substring(Alfresco.constants.URL_CONTEXT.length);return E(W[X],"/",ab)},onActionPublish:function l(W){Alfresco.module.getSocialPublishingInstance().show({nodeRef:W.nodeRef,filename:W.fileName})},onActionCloudSync:function Q(W){if(!i){i=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var Y=this;YAHOO.Bubbling.on("folderSelected",function Z(ac,ab){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:Y.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:ab[1].selectedFolder.nodeRef}),successCallback:{fn:function ad(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},i)}else{var aa=i.widgets.optionInputs;if(aa){for(var X=0;X<aa.length;X++){aa[X].checked=aa[X].defaultChecked}}}if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}i.setOptions({files:W});this.modules.cloudAuth.setOptions({authCallback:i.showDialog,authCallbackContext:i}).checkAuth()},onActionCloudUnsync:function B(Y){var ad=this,ac=Y.jsNode.isContainer?"folder":"document",X=Y.displayName,ab=(this.options.syncMode==="CLOUD"),W=ab?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+ac+".from.cloud",X)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ac+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",X)+W,buttons:[{text:this.msg("button.unsync"),handler:function Z(){var ae=ab?false:M.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+Y.jsNode.nodeRef.uri+"?requestDeleteRemote="+ae,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function af(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:ad.msg("message.unsync.success")})},scope:ad},failureMessage:ad.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function aa(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function y(W,aa){var Y=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(aa),{text:this.msg("label.loading"),width:"455px"});Y.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+W.nodeRef.replace("://","/"),successCallback:{fn:function Z(ac){var ad=this,ab={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,W,ac.json,ab,function(af){if(af!=null){Y.html(af.html);Y.requestsync=Alfresco.util.createYUIButton(ad,"button-requestsyn",function(){ad.onActionCloudSyncRequest(W);Y.hide()},{id:ad.id});if(!af.showRequestSyncButton&&Y.requestsync!=null){Y.requestsync.setStyle("display","none")}Y.unsync=Alfresco.util.createYUIButton(ad,"button-unsync",function(){ad.onActionCloudUnsync(W);Y.hide()},{id:ad.id});if(!af.showUnsyncButton&&Y.unsync!=null){Y.unsync.setStyle("display","none")}var ae=Y.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(ad,ae);Alfresco.util.syncClickOnHideLinkEvent(ad,ae);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(ad,ae);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(ad,ae)}else{Y.hide()}})},scope:this},failureCallback:{fn:function X(ab){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function u(W,Y){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(W)},successCallback:{fn:function X(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(W){var Y=new Array();if(YAHOO.lang.isArray(W)){for(var X in W){Y.push(W[X].nodeRef)}}else{Y.push(W.nodeRef)}return Y},onCloudSyncFailedIndicatorAction:function A(W,X){this.onCloudSyncIndicatorAction(W,X)},onCloudIndirectSyncIndicatorAction:function S(W,X){this.onCloudSyncIndicatorAction(W,X)},onCloudIndirectSyncFailedIndicatorAction:function H(W,X){this.onCloudSyncIndicatorAction(W,X)}}})();(function(){var b=YAHOO.util.Event;var f=Alfresco.util.combinePaths,d=Alfresco.util.relativeTime;YAHOO.lang.augmentObject(Alfresco.util,{getSyncStatus:function h(m,k,j,i,o){Alfresco.util.Ajax.request({url:f(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloud-sync-status")+"?htmlid="+m.id+"&nodeRef="+k.nodeRef,dataObj:{nodeDetails:j},successCallback:{fn:function n(p){var L=new Alfresco.util.Node(p.config.dataObj.nodeDetails.item.node),v=L.properties,N=v.sync_syncTime,F=v.sync_syncOwner,H=(v.sync_syncRequested==="true"),T=i.showTitle?"<h2>"+m.msg("sync.status.title")+"</h2>":"",I=m.msg("sync.status.pending",null,null,G),u=m.msg("label.you"),B=L.hasAspect("sync:failed"),t=L.hasAspect("sync:transientError"),J=L.hasAspect("cm:workingcopy"),Q="sync.status.",G="";if(J){Q+="copy.";G="<a href='document-details?nodeRef="+k.workingCopy.sourceNodeRef+"'>"+m.msg("sync.original-document")+"</a>"}if(F!==Alfresco.constants.USERNAME){var s=p.serverResponse.responseText.match(/data-sync-owner-fullname="(.*?)"/),w=(s&&s[1])?s[1]:F;u=Alfresco.util.userProfileLink(F,w)}if(B&&!H){var S=d(v.sync_errorTime.iso8601);I=m.msg(Q+"failed",S,u,G)}if(N&&!H){var A=d(N.iso8601);if(B){I+="<br />"+m.msg(Q+"last-attempt",A,u,G)}else{I=m.msg(Q+"synced",A,u,G)}}var M="hidden",P="hidden",x="",q="",E="",D="";if(B){M="visible";x=m.msg(v["sync:errorCode"]);q=v["sync:errorDetails"]}if(t){P="visible";E=m.msg(v["sync:transientErrorCode"]);D=v["sync:transientErrorDetails"]||m.msg("sync.status.transient-error.default-details")}var z=k.actions;var O=false,R="hidden";if(i.showRequestSyncButton&&Alfresco.util.findInArray(z,"document-request-sync","id")){O=true;R="visible"}var r=false,K="hidden";if(i.showUnsyncButton&&Alfresco.util.findInArray(z,"document-cloud-unsync","id")){r=true;K="visible"}var y="";var C=YAHOO.lang.substitute(p.serverResponse.responseText,{title:T,status:I,syncFailed:M,errorCode:x,errorDetails:q,transientError:P,transientErrorCode:E,transientErrorDetails:D,requestSyncButtonClass:R,unsyncButtonClass:K,showMoreInfoLink:y});o({html:C,showRequestSyncButton:O,showUnsyncButton:r})},scope:m},failureCallback:{fn:function l(p){Alfresco.util.PopupManager.displayMessage({text:m.msg("sync.unable.diplay.status")});o(null)},scope:m}})},syncClickOnShowDetailsLinkEvent:function e(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-show-link","a",i),"click",function j(l){b.preventDefault(l);if(!Dom.hasClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden")[0]){Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")}Dom.removeClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")},{},k)},syncClickOnTransientErrorShowDetailsLinkEvent:function g(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient","a",i),"click",function j(l){b.preventDefault(l);if(!Dom.hasClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden")[0]){Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")}Dom.removeClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")},{},k)},syncClickOnHideLinkEvent:function a(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link","a",i),"click",function j(l){b.preventDefault(l);Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link"),"hidden")},{},k)},syncClickOnTransientErrorHideLinkEvent:function c(k,i){b.on(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient","a",i),"click",function j(l){b.preventDefault(l);Dom.addClass(Dom.getElementsByClassName("cloud-sync-error-detailed-transient"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-info"),"hidden");Dom.removeClass(Dom.getElementsByClassName("cloud-sync-details-failed-show-link-transient"),"hidden");Dom.addClass(Dom.getElementsByClassName("cloud-sync-details-failed-hide-link-transient"),"hidden")},{},k)}},true)})();(function(){var j=YAHOO.util.Dom,a=YAHOO.util.Selector,d=YAHOO.util.KeyListener;Alfresco.module.SimpleDialog=function(o,p){p=YAHOO.lang.isArray(p)?p:[];this.isFormOwner=false;if(o!=="null"){this.formsServiceDeferred=new Alfresco.util.Deferred(["onTemplateLoaded","onBeforeFormRuntimeInit"],{fn:this._showDialog,scope:this});YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this)}return Alfresco.module.SimpleDialog.superclass.constructor.call(this,"Alfresco.module.SimpleDialog",o,["button","container","connection","json","selector"].concat(p))};YAHOO.extend(Alfresco.module.SimpleDialog,Alfresco.component.Base,{dialog:null,form:null,isFormOwner:null,options:{templateUrl:null,actionUrl:null,firstFocus:null,onSuccess:{fn:null,obj:null,scope:window},onSuccessMessage:"",onFailure:{fn:null,obj:null,scope:window},onFailureMessage:"",doBeforeDialogShow:{fn:null,obj:null,scope:null},doSetupFormsValidation:{fn:null,obj:null,scope:null},doBeforeFormSubmit:{fn:null,obj:null,scope:window},doBeforeAjaxRequest:{fn:null,obj:null,scope:window},width:"30em",clearForm:false,destroyOnHide:false},show:function b(){if(this.dialog){this._showDialog()}else{var o={htmlid:this.id};if(this.options.templateRequestParams){o=YAHOO.lang.merge(this.options.templateRequestParams,o)}Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:o,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load dialog template from '"+this.options.templateUrl+"'.",scope:this,execScripts:true})}return this},_showDialog:function e(){var o=j.get(this.id+"-form");j.addClass(o,"bd");var x=this.options.doSetupFormsValidation;if(typeof x.fn=="function"){x.fn.call(x.scope||this,this.form,x.obj)}var q=this.options.doBeforeFormSubmit;if(typeof q.fn=="function"){this.form.doBeforeFormSubmit=q}else{this.form.doBeforeFormSubmit={fn:function p(){this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},scope:this}}var s=this.options.doBeforeAjaxRequest;if(typeof s.fn=="function"){this.form.doBeforeAjaxRequest=s}if(this.options.actionUrl!==null){o.attributes.action.nodeValue=this.options.actionUrl}if(this.options.clearForm){var u=a.query("input",o),v;u=u.concat(a.query("textarea",o));for(var t=0,r=u.length;t<r;t++){v=u[t];if(v.getAttribute("type")!="radio"&&v.getAttribute("type")!="checkbox"&&v.getAttribute("type")!="hidden"){v.value=""}}}var w=this.options.doBeforeDialogShow;if(w&&typeof w.fn=="function"){w.fn.call(w.scope||this,this.form,this,w.obj)}if(this.isFormOwner){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)}this.form.updateSubmitElements();this.dialog.show();Alfresco.util.caretFix(o);this.form.applyTabFix();this.widgets.escapeListener=new d(document,{keys:d.KEY.ESCAPE},{fn:function(z,y){this.hide()},scope:this,correctScope:true});this.widgets.escapeListener.enable();if(this.options.firstFocus!==null){j.get(this.options.firstFocus).focus()}},hide:function k(){if(this.dialog){this.dialog.hide()}},_hideDialog:function g(){this.dialog.hideEvent.unsubscribe(this.onHideEvent,null,this);if(this.widgets.escapeListener){this.widgets.escapeListener.disable()}var o=j.get(this.id+"-form");Alfresco.util.undoCaretFix(o);if(this.options.destroyOnHide){YAHOO.Bubbling.fire("formContainerDestroyed");YAHOO.Bubbling.unsubscribe("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);this.dialog.destroy();delete this.dialog;delete this.widgets;if(this.isFormOwner){delete this.form}}},onHideEvent:function n(p,o){YAHOO.lang.later(0,this,this._hideDialog)},onTemplateLoaded:function f(o){var q=document.createElement("div");q.innerHTML=o.serverResponse.responseText;var p=j.getFirstChild(q);while(p&&p.tagName.toLowerCase()!="div"){p=j.getNextSibling(p)}this.dialog=Alfresco.util.createYUIPanel(p,{width:this.options.width});this.dialog.hideEvent.subscribe(this.onHideEvent,null,this);if(j.get(this.id+"-form-submit")){this.isFormOwner=false;this.formsServiceDeferred.fulfil("onTemplateLoaded")}else{this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);this.isFormOwner=true;this.form=new Alfresco.forms.Form(this.id+"-form");this.form.setSubmitElements(this.widgets.okButton);this.form.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this},failureCallback:{fn:this.onFailure,scope:this}});this.form.setSubmitAsJSON(true);this.form.setShowSubmitStateDynamically(true,false);this.form.init();this._showDialog()}},onBeforeFormRuntimeInit:function c(p,o){var q=o[1].component,r=o[1].runtime;this.widgets.okButton=q.buttons.submit;this.widgets.okButton.set("label",this.msg("button.save"));this.widgets.cancelButton=q.buttons.cancel;this.widgets.cancelButton.set("onclick",{fn:this.onCancel,scope:this});this.form=r;this.form.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this},failureCallback:{fn:this.onFailure,scope:this}});this.formsServiceDeferred.fulfil("onBeforeFormRuntimeInit")},onCancel:function h(o,p){this.hide()},onSuccess:function i(o){this.hide();if(!o){if(this.options.onFailure&&typeof this.options.onFailure.fn=="function"){this.options.onFailure.fn.call(this.options.onFailure.scope,null,this.options.onFailure.obj)}else{Alfresco.util.PopupManager.displayMessage({text:this.options.failureMessage||"Operation failed."})}}else{if(this.options.onSuccess&&typeof this.options.onSuccess.fn=="function"){this.options.onSuccess.fn.call(this.options.onSuccess.scope,o,this.options.onSuccess.obj)}else{Alfresco.util.PopupManager.displayMessage({text:this.options.successMessage||"Operation succeeded."})}}},onFailure:function m(o){if(this.isFormOwner){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)}this.form.updateSubmitElements();if(typeof this.options.onFailure.fn=="function"){this.options.onFailure.fn.call(this.options.onFailure.scope,o,this.options.onFailure.obj)}else{if(o.json&&o.json.message&&o.json.status.name){Alfresco.util.PopupManager.displayPrompt({title:o.json.status.name,text:o.json.message})}else{Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:o.serverResponse})}}}});var l=new Alfresco.module.SimpleDialog("null")})();(function(){var b=YAHOO.util.Dom,B=YAHOO.util.Event,q=YAHOO.util.KeyListener,v=YAHOO.util.Selector;var s=Alfresco.util.encodeHTML,p=Alfresco.util.combinePaths,z=Alfresco.util.hasEventInterest;Alfresco.module.DoclibGlobalFolder=function(C){Alfresco.module.DoclibGlobalFolder.superclass.constructor.call(this,"Alfresco.module.DoclibGlobalFolder",C,["button","container","connection","json","treeview"]);this.containers={};if(C!="null"){this.eventGroup=C;YAHOO.Bubbling.on("siteChanged",this.onSiteChanged,this);YAHOO.Bubbling.on("containerChanged",this.onContainerChanged,this)}return this};var x=Alfresco.module.DoclibGlobalFolder;YAHOO.lang.augmentObject(x,{VIEW_MODE_SITE:0,VIEW_MODE_REPOSITORY:1,VIEW_MODE_USERHOME:2});YAHOO.extend(Alfresco.module.DoclibGlobalFolder,Alfresco.component.Base,{options:{siteId:"",siteTitle:"",containerId:"documentLibrary",containerType:"cm:folder",rootNode:"alfresco://company/home",userHome:"alfresco://user/home",path:"",pathNodeRef:null,width:"60em",files:null,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/global-folder",viewMode:x.VIEW_MODE_SITE,allowedViewModes:[x.VIEW_MODE_SITE,x.VIEW_MODE_REPOSITORY,x.VIEW_MODE_USERHOME],evaluateChildFoldersSite:true,maximumFolderCountSite:-1,evaluateChildFoldersRepo:true,maximumFolderCountRepo:-1,siteTreeContainerTypes:{},sitesAPI:Alfresco.constants.PROXY_URI+"api/people/"+encodeURIComponent(Alfresco.constants.USERNAME)+"/sites",containersAPI:Alfresco.constants.PROXY_URI+"slingshot/doclib/containers/",templateFailMessage:"Could not load 'global-folder' template"},containerDiv:null,pathsToExpand:null,selectedNode:null,containers:null,showDialog:function k(){if(!this.containerDiv){Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:this.options.templateFailMessage,execScripts:true})}else{this._beforeShowDialog()}},onTemplateLoaded:function m(D){var H=this;this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=D.serverResponse.responseText;var F=b.getFirstChild(this.containerDiv);this.widgets.dialog=Alfresco.util.createYUIPanel(F,{width:this.options.width});this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",this.onOK);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);var J=new YAHOO.widget.ButtonGroup(this.id+"-modeGroup");J.on("checkedButtonChange",this.onViewModeChange,this.widgets.modeButtons,this);this.widgets.modeButtons=J;var G=this.widgets.modeButtons.getButtons(),I=function(K){if(q.KEY.ENTER==K.keyCode){this.set("checked",true)}};for(var E=0;E<G.length;E++){G[E].addListener("keydown",I)}this.fnLoadNodeData=function C(O,L){var M=O.data.path;var N=H._buildTreeNodeUrl.call(H,M);var Q={success:function K(U){var T=Alfresco.util.parseJSON(U.responseText);if(T.parent){if(O.data.nodeRef.indexOf("alfresco://")===0){O.data.nodeRef=T.parent.nodeRef}if(typeof O.data.userAccess=="undefined"){O.data.userAccess=T.parent.userAccess;O.setUpLabel({label:O.label,style:T.parent.userAccess.create?"":"no-permission"})}}if(T.items){var V,X;for(var S=0,R=T.items.length;S<R;S++){V=T.items[S];var W=this.options.mode=="sync"&&Alfresco.util.arrayContains(V.aspects,"sync:syncSetMemberNode");X=new YAHOO.widget.TextNode({label:s(V.name),path:p(M,V.name),nodeRef:V.nodeRef,description:V.description,userAccess:W?false:V.userAccess,style:W?"no-permission":(V.userAccess.create?"":"no-permission")},O,false);if(!V.hasChildren){X.isLeaf=true}}if(T.resultsTrimmed){X=new YAHOO.widget.TextNode({label:"&lt;"+this.msg("message.folders-trimmed")+"&gt;",style:"folders-trimmed"},O,false)}}U.argument.fnLoadComplete()},failure:function P(U){try{var T=YAHOO.lang.JSON.parse(U.responseText);var S=this.widgets.treeview.getRoot();var R=S.children[0];R.isLoading=false;R.isLeaf=true;R.label=T.message;R.labelStyle="ygtverror";S.refresh()}catch(V){}},scope:H,argument:{node:O,fnLoadComplete:L},timeout:7000};if(YAHOO.env.ua.ie>0){N+=(N.indexOf("?")==-1?"?":"&")+"noCache="+new Date().getTime()}YAHOO.util.Connect.asyncRequest("GET",N,Q)};this._beforeShowDialog()},_beforeShowDialog:function r(){if(this.options.pathNodeRef){var C=Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+this.options.pathNodeRef.uri+"/location";if(this.options.rootNode){C+="?libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.jsonGet({url:C,successCallback:{fn:function(E){if(E.json!==undefined){var D=E.json;if(D.site){this.options.viewMode=x.VIEW_MODE_SITE;this.options.path=p(D.site.path,D.site.file);this.options.siteId=D.site.site;this.options.siteTitle=D.site.siteTitle}else{this.options.viewMode=x.VIEW_MODE_REPOSITORY;this.options.path=p(D.repo.path,D.repo.file);this.options.siteId=null;this.options.siteTitle=null}this._showDialog()}},scope:this},failureMessage:this.msg("message.failure")})}else{this._showDialog()}},_showDialog:function o(){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false);var G=b.get(this.id+"-title");if(this.options.title){G.innerHTML=this.options.title}else{if(YAHOO.lang.isArray(this.options.files)){G.innerHTML=this.msg("title.multi",this.options.files.length)}else{G.innerHTML=this.msg("title.single",'<span class="light">'+s(this.options.files.displayName)+"</span>")}}var C=Alfresco.util.arrayToObject(this.options.allowedViewModes),H=this.widgets.modeButtons.getButtons(),I,E;if(!(this.options.viewMode in C)){this.options.viewMode=this.options.allowedViewModes[0]}for(var D=0,F=H.length;D<F;D++){I=H[D];E=parseInt(I.get("name"),10);I.set("disabled",!(E in C));I.setStyle("display",E in C?"block":"none");if(E==this.options.viewMode){if(I.get("checked")){this.setViewMode(E)}else{I.set("checked",true)}}}if(!this.widgets.escapeListener){this.widgets.escapeListener=new q(document,{keys:q.KEY.ESCAPE},{fn:function(K,J){this.onCancel()},scope:this,correctScope:true})}this.widgets.escapeListener.enable();this.widgets.dialog.show()},setViewMode:function i(C){this.options.viewMode=C;if(C==x.VIEW_MODE_SITE){b.get(this.id+"-treeview").innerHTML="";b.removeClass(this.id+"-wrapper","repository-mode");this._populateSitePicker()}else{b.addClass(this.id+"-wrapper","repository-mode");this._buildTree(C==x.VIEW_MODE_USERHOME?this.options.userHome:this.options.rootNode);this.onPathChanged(this.options.path?this.options.path:"/")}},onSiteChanged:function y(H,F){if(z(this,F)){var J=F[1];if(J!==null){if(J.site!==null){this.options.siteId=J.site;this.options.siteTitle=J.siteTitle;this._populateContainerPicker();var I=v.query("a",this.id+"-sitePicker"),E,G,D,C=b.get(this.id+"-sitePicker");for(G=0,D=I.length;G<D;G++){E=I[G];if(E.getAttribute("rel")==J.site){b.addClass(E,"selected");if(J.scrollTo){C.scrollTop=b.getY(E)-b.getY(C)}}else{b.removeClass(E,"selected")}}}}}},onContainerChanged:function f(H,F){if(z(this,F)){var J=F[1];if(J!==null){if(J.container!==null){this.options.containerId=J.container;this.options.containerType=this.containers[J.container].type;this._buildTree(this.containers[J.container].nodeRef);this.onPathChanged(this.options.path);var I=v.query("a",this.id+"-containerPicker"),C,G,E,D=b.get(this.id+"-containerPicker");for(G=0,E=I.length;G<E;G++){C=I[G];if(C.getAttribute("rel")==J.container){b.addClass(C,"selected");if(J.scrollTo){D.scrollTop=b.getY(C)-b.getY(D)}}else{b.removeClass(C,"selected")}}}}}},onOK:function j(D,E){this.widgets.escapeListener.disable();this.widgets.dialog.hide();var C=this.selectedNode?this.selectedNode.data:null;if(C&&this.options.viewMode==x.VIEW_MODE_SITE){C.siteId=this.options.siteId;C.siteTitle=this.options.siteTitle;C.containerId=this.options.containerId}YAHOO.Bubbling.fire("folderSelected",{selectedFolder:C,eventGroup:this})},onCancel:function a(C,D){this.widgets.escapeListener.disable();this.widgets.dialog.hide()},onViewModeChange:function l(E,F){var D=this.options.viewMode;try{D=parseInt(E.newValue.get("name"),10);this.setViewMode(D)}catch(C){}},onExpandComplete:function h(F){Alfresco.logger.debug("DLGF_onExpandComplete");this.widgets.treeview.render();this._showHighlight(true);if(this.pathsToExpand&&this.pathsToExpand.length>0){var E=this.widgets.treeview.getNodeByProperty("path",this.pathsToExpand.shift());if(E!==null){var D=E.getContentEl(),C=b.get(this.id+"-treeview");C.scrollTop=b.getY(D)-(C.scrollHeight/3);if(E.data.path==this.currentPath){this._updateSelectedNode(E)}E.expand()}}},onNodeClicked:function u(D){Alfresco.logger.debug("DLGF_onNodeClicked");var F=D.event,E=D.node,C=E.data.userAccess;if((C&&C.create)||(E.data.nodeRef=="")||(E.data.nodeRef.indexOf("alfresco://")===0)){this.onPathChanged(E.data.path);this._updateSelectedNode(E)}B.preventDefault(F);return false},onPathChanged:function d(G){Alfresco.logger.debug("DLGF_onPathChanged:"+G);if(G.charAt(0)!="/"){G="/"+G}this.currentPath=G;var F=this.widgets.treeview.getNodeByProperty("path",G);if(F!==null){this._updateSelectedNode(F);F.expand();while(F.parent!==null){F=F.parent;F.expand()}return}var H=G.split("/"),E="/";if(G==="/"){H=[""]}this.pathsToExpand=[];for(var D=0,C=H.length;D<C;D++){E=p("/",E,H[D]);this.pathsToExpand.push(E)}Alfresco.logger.debug("DLGF_onPathChanged paths to expand:"+this.pathsToExpand.join(","));do{F=this.widgets.treeview.getNodeByProperty("path",this.pathsToExpand.shift())}while(this.pathsToExpand.length>0&&F.expanded);if(F!==null){F.expand()}},_populateSitePicker:function w(){var D=b.get(this.id+"-sitePicker"),G=this;D.innerHTML="";var F=function C(J,N){var O=J.json,L,H,M,K,Q=null;var P=function I(R){return function(){YAHOO.Bubbling.fire("siteChanged",{site:R.shortName,siteTitle:R.title,eventGroup:G});return false}};if(O.length>0){Q=O[0]}for(M=0,K=O.length;M<K;M++){H=O[M];L=document.createElement("div");if(M==K-1){b.addClass(L,"last")}L.innerHTML='<a rel="'+H.shortName+'" href="#""><h4>'+s(H.title)+"</h4><span>"+s(H.description)+"</span></a>";L.onclick=P(H);N.appendChild(L)}if(Q!=null){YAHOO.Bubbling.fire("siteChanged",{site:(this.options.siteId&&this.options.siteId.length>0)?this.options.siteId:Q.shortName,siteTitle:(this.options.siteId&&this.options.siteId.length>0)?this.options.siteTitle:Q.title,eventGroup:this,scrollTo:true})}};var E={url:this.options.sitesAPI,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:F,scope:this,obj:D},failureCallback:null};Alfresco.util.Ajax.request(E)},_populateContainerPicker:function e(){var J=b.get(this.id+"-containerPicker"),G=this;J.innerHTML="";var F=function C(M,R){var L=M.json.containers,O,K,P,N;this.containers={};var S=function Q(T){return function(){YAHOO.Bubbling.fire("containerChanged",{container:T,eventGroup:G});return false}};for(P=0,N=L.length;P<N;P++){K=L[P];this.containers[K.name]=K;O=document.createElement("div");if(P==N-1){b.addClass(O,"last")}O.innerHTML='<a rel="'+K.name+'" href="#"><h4>'+K.name+"</h4><span>"+K.description+"</span></a>";O.onclick=S(K.name);R.appendChild(O)}YAHOO.Bubbling.fire("containerChanged",{container:this.options.containerId,eventGroup:this,scrollTo:true})};var I=function H(M){try{var L=this.widgets.treeview.getRoot(),K=L.children[0];K.isLoading=false;K.isLeaf=true;K.label=this.msg("message.error");K.labelStyle="ygtverror";L.refresh()}catch(N){}J.innerHTML=""};var E=Alfresco.util.parseURL(this.options.containersAPI);E.pathname+=this.options.siteId;var D={url:E.getUrl(),responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:F,scope:this,obj:J},failureCallback:{fn:I,scope:this}};Alfresco.util.Ajax.request(D)},_buildTree:function g(F){Alfresco.logger.debug("DLGF__buildTree");var C=new YAHOO.widget.TreeView(this.id+"-treeview");this.widgets.treeview=C;YAHOO.widget.TreeView.FOCUS_CLASS_NAME="";C.setDynamicLoad(this.fnLoadNodeData);var D="location.path.repository";if(this.options.viewMode==x.VIEW_MODE_SITE){var E=this.options.siteTreeContainerTypes[this.options.containerType]||{};D=E.rootLabel||"location.path.documents"}else{if(this.options.viewMode==x.VIEW_MODE_USERHOME){D="location.path.userHome"}}var G=new YAHOO.widget.TextNode({label:this.msg(D),path:"/",nodeRef:F},C.getRoot(),false);C.subscribe("clickEvent",this.onNodeClicked,this,true);C.subscribe("expandComplete",this.onExpandComplete,this,true);C.render()},_showHighlight:function n(C){Alfresco.logger.debug("DLGF__showHighlight");if(this.selectedNode!==null){if(C){b.addClass(this.selectedNode.getEl(),"selected")}else{b.removeClass(this.selectedNode.getEl(),"selected")}}},_updateSelectedNode:function t(C){Alfresco.logger.debug("DLGF__updateSelectedNode");this._showHighlight(false);this.selectedNode=C;this._showHighlight(true)},_buildTreeNodeUrl:function c(E){var F=Alfresco.constants.PROXY_URI;if(this.options.viewMode==x.VIEW_MODE_SITE){var C=this.options.siteTreeContainerTypes[this.options.containerType]||{};if(C.uri){F+=C.uri}else{F+="slingshot/doclib/treenode/site/{site}/{container}{path}";F+="?children={evaluateChildFoldersSite}";F+="&max={maximumFolderCountSite}"}}else{if(this.options.viewMode==x.VIEW_MODE_USERHOME){F+="slingshot/doclib/treenode/node/{userHome}{path}";F+="?children={evaluateChildFoldersRepo}"}else{F+="slingshot/doclib/treenode/node/alfresco/company/home{path}";F+="?children={evaluateChildFoldersRepo}";F+="&libraryRoot={rootNode}"}F+="&max={maximumFolderCountRepo}"}var D=YAHOO.lang.substitute(F,{site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),rootNode:this.options.rootNode,userHome:(this.options.userHome||"").replace(":/",""),path:Alfresco.util.encodeURIPath(E),evaluateChildFoldersSite:this.options.evaluateChildFoldersSite+"",maximumFolderCountSite:this.options.maximumFolderCountSite,evaluateChildFoldersRepo:this.options.evaluateChildFoldersRepo+"",maximumFolderCountRepo:this.options.maximumFolderCountRepo});return D}});var A=new Alfresco.module.DoclibGlobalFolder("null")})();(function(){Alfresco.module.DoclibCopyMoveTo=function(h){Alfresco.module.DoclibCopyMoveTo.superclass.constructor.call(this,h);this.name="Alfresco.module.DoclibCopyMoveTo";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,{allowedViewModes:[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME],extendedTemplateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/copy-move-to"});return this};YAHOO.extend(Alfresco.module.DoclibCopyMoveTo,Alfresco.module.DoclibGlobalFolder,{setOptions:function g(j){var h={};if(typeof j.mode!=="undefined"){var i={copy:"copy-to",move:"move-to"};if(typeof i[j.mode]=="undefined"){throw new Error("Alfresco.module.CopyMoveTo: Invalid mode '"+j.mode+"'")}h.dataWebScript=i[j.mode]}h.viewMode=Alfresco.util.isValueSet(this.options.siteId)?Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE:Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY;this.modules.actions=new Alfresco.module.DoclibActions();return Alfresco.module.DoclibCopyMoveTo.superclass.setOptions.call(this,YAHOO.lang.merge(h,j))},onTemplateLoaded:function a(h){Alfresco.util.Ajax.request({url:this.options.extendedTemplateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onExtendedTemplateLoaded,obj:h,scope:this},failureMessage:"Could not load 'copy-move-to' template:"+this.options.extendedTemplateUrl,execScripts:true})},onExtendedTemplateLoaded:function c(h,i){Alfresco.module.DoclibCopyMoveTo.superclass.onTemplateLoaded.call(this,i)},onOK:function d(q,v){var k,w=[],n,p,o,m={copy:"Copied",move:"Moved"};if(YAHOO.lang.isArray(this.options.files)){k=this.options.files}else{k=[this.options.files]}for(p=0,o=k.length;p<o;p++){w.push(k[p].node.nodeRef)}var u=function s(A){var x,B=A.json.successCount,C=A.json.failureCount;this.widgets.dialog.hide();if(!A.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")});return}YAHOO.Bubbling.fire("files"+m[this.options.mode],{destination:this.currentPath,successCount:B,failureCount:C});for(var z=0,y=A.json.totalResults;z<y;z++){x=A.json.results[z];if(x.success){YAHOO.Bubbling.fire((x.type=="folder"?"folder":"file")+m[this.options.mode],{multiple:true,nodeRef:x.nodeRef,destination:this.currentPath})}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.success",B)})};var l=function h(i){this.widgets.dialog.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})};var r=this.options.dataWebScript+"/node/{nodeRef}",t=new Alfresco.util.NodeRef(this.selectedNode.data.nodeRef);this.modules.actions.genericAction({success:{callback:{fn:u,scope:this}},failure:{callback:{fn:l,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:r,params:{nodeRef:t.uri}},wait:{message:this.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:w,parentId:this.options.parentId}}});this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},msg:function b(i){var h=Alfresco.util.message.call(this,this.options.mode+"."+i,this.name,Array.prototype.slice.call(arguments).slice(1));if(h==(this.options.mode+"."+i)){h=Alfresco.util.message.call(this,i,this.name,Array.prototype.slice.call(arguments).slice(1))}if(h==i){h=Alfresco.util.message(i,"Alfresco.module.DoclibGlobalFolder",Array.prototype.slice.call(arguments).slice(1))}return h},_showDialog:function f(){this.widgets.okButton.set("label",this.msg("button"));return Alfresco.module.DoclibCopyMoveTo.superclass._showDialog.apply(this,arguments)}});var e=new Alfresco.module.DoclibCopyMoveTo("null")})();(function(){var g=YAHOO.util.Dom,p=YAHOO.util.Event;var f=Alfresco.util.encodeHTML,i=Alfresco.util.userProfileLink;Alfresco.PeopleFinder=function(r){Alfresco.PeopleFinder.superclass.constructor.call(this,"Alfresco.PeopleFinder",r,["button","container","datasource","datatable","json"]);this.userSelectButtons={};this.searchTerm="";this.singleSelectedUser="";this.selectedUsers={};this.notAllowed={};this.following={};YAHOO.Bubbling.on("personSelected",this.onPersonSelected,this);YAHOO.Bubbling.on("personDeselected",this.onPersonDeselected,this);return this};YAHOO.lang.augmentObject(Alfresco.PeopleFinder,{VIEW_MODE_DEFAULT:"",VIEW_MODE_COMPACT:"COMPACT",VIEW_MODE_FULLPAGE:"FULLPAGE"});YAHOO.lang.extend(Alfresco.PeopleFinder,Alfresco.component.Base,{options:{siteId:"",viewMode:Alfresco.PeopleFinder.VIEW_MODE_DEFAULT,singleSelectMode:false,showSelf:true,minSearchTermLength:1,maxSearchResults:100,setFocus:false,addButtonLabel:null,addButtonSuffix:"",dataWebScript:"",userId:""},userSelectButtons:null,searchTerm:null,singleSelectedUser:null,selectedUsers:null,notAllowed:null,isSearching:false,following:null,onReady:function c(){var s=this;if(this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){g.addClass(this.id+"-body","compact");g.removeClass(this.id+"-results","hidden")}else{if(this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE){g.setStyle(this.id+"-results","height","auto");g.removeClass(this.id+"-help","hidden");Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/following",successCallback:{fn:function(w){if(w.json.people){var z={};var y=w.json.people;for(var x=0;x<y.length;x++){z[y[x].userName]=true}s.following=z}},scope:this}})}else{g.setStyle(this.id+"-results","height","300px");g.removeClass(this.id+"-results","hidden")}}this.widgets.searchButton=Alfresco.util.createYUIButton(this,"search-button",this.onSearchClick);var v=Alfresco.constants.PROXY_URI+YAHOO.lang.substitute(this.options.dataWebScript,this.options);v+=(v.indexOf("?")<0)?"?":"&";this.widgets.dataSource=new YAHOO.util.DataSource(v,{responseType:YAHOO.util.DataSource.TYPE_JSON,connXhrMode:"queueRequests",responseSchema:{resultsList:"people"}});this.widgets.dataSource.doBeforeParseData=function u(B,y){var x=y;if(y){var w=y.people,z,A;if(w.length>s.options.maxSearchResults){w=w.slice(0,s.options.maxSearchResults-1)}if(!s.options.showSelf){for(z=0,A=w.length;z<A;z++){if(w[z].userName==Alfresco.constants.USERNAME){w.splice(z,1);break}}}w.sort(function(F,E){var D=F.firstName+F.lastName,C=E.firstName+E.lastName;return(D>C)?1:(D<C)?-1:0});s.notAllowed={};if(y.notAllowed){s.notAllowed=Alfresco.util.arrayToObject(y.notAllowed)}x={people:w}}return x};this._setupDataTable();var t=g.get(this.id+"-search-text");var r=new YAHOO.util.KeyListener(t,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(w,x,y){s.onSearchClick();p.stopEvent(x[1]);return false},scope:this,correctScope:true},YAHOO.env.ua.ie>0?YAHOO.util.KeyListener.KEYDOWN:"keypress");r.enable();if(this.options.setFocus){t.focus()}},_setupDataTable:function d(){var x=this;var t=function w(C,B,D,E){g.setStyle(C.parentNode,"width",D.width+"px");var A=Alfresco.constants.URL_RESCONTEXT+"components/images/no-user-photo-64.png";if(B.getData("avatar")!==undefined){A=Alfresco.constants.PROXY_URI+B.getData("avatar")+"?c=queue&ph=true"}C.innerHTML='<img class="avatar" src="'+A+'" alt="avatar" />'};var s=function y(J,M,G,D){var I=M.getData("userName"),C=I,K=M.getData("firstName"),L=M.getData("lastName"),A=M.getData("userStatus"),E=M.getData("userStatusTime");if((K!==undefined)||(L!==undefined)){C=K?K+" ":"";C+=L?L:""}var H=M.getData("jobtitle")||"",B=M.getData("organization")||"";var F='<h3 class="itemname">'+i(I,C,'class="theme-color-1" tabindex="0"')+' <span class="lighter">('+f(I)+")</span></h3>";if(H.length!==0){if(x.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="detail">'+f(H)+"</div>"}else{F+='<div class="detail"><span>'+x.msg("label.title")+":</span> "+f(H)+"</div>"}}if(B.length!==0){if(x.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="detail">&nbsp;('+f(B)+")</div>"}else{F+='<div class="detail"><span>'+x.msg("label.company")+":</span> "+f(B)+"</div>"}}if(A!==null&&x.options.viewMode!==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="user-status">'+f(A)+" <span>("+Alfresco.util.relativeTime(Alfresco.util.fromISO8601(E.iso8601))+")</span></div>"}J.innerHTML=F};var r=function u(E,C,F,H){g.setStyle(E.parentNode,"width",F.width+"px");g.setStyle(E.parentNode,"text-align","right");var D=C.getData("userName"),G='<span id="'+x.id+"-action-"+D+'"></span>';E.innerHTML=G;if(x.options.viewMode!==Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE){var A=new YAHOO.widget.Button({type:"button",label:(x.options.addButtonLabel?x.options.addButtonLabel:x.msg("button.add"))+" "+x.options.addButtonSuffix,name:x.id+"-selectbutton-"+D,container:x.id+"-action-"+D,tabindex:0,disabled:D in x.notAllowed,onclick:{fn:x.onPersonSelect,obj:C,scope:x}});x.userSelectButtons[D]=A;if((D in x.selectedUsers)||(x.options.singleSelectMode&&x.singleSelectedUser!=="")){x.userSelectButtons[D].set("disabled",true)}}if(x.options.viewMode===Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE&&x.options.userId!==D){var B=x.following[D];var A=new YAHOO.widget.Button({type:"button",label:B?x.msg("button.unfollow"):x.msg("button.follow"),name:x.id+"-followbutton-"+D,container:x.id+"-action-"+D,tabindex:0});A.set("onclick",{fn:B?x.onPersonUnfollow:x.onPersonFollow,obj:{record:C,button:A},scope:x})}};var v=[{key:"avatar",label:"Avatar",sortable:false,formatter:t,width:this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT?36:70},{key:"person",label:"Description",sortable:false,formatter:s},{key:"actions",label:"Actions",sortable:false,formatter:r,width:80}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-results",v,this.widgets.dataSource,{renderLoopSize:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,MSG_EMPTY:this.msg("message.instructions")});this.widgets.dataTable.doBeforeLoadData=function z(A,B,C){if(B.results){this.renderLoopSize=Alfresco.util.RENDERLOOPSIZE}return true};this.widgets.dataTable.subscribe("rowMouseoverEvent",this.widgets.dataTable.onEventHighlightRow);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.widgets.dataTable.onEventUnhighlightRow)},clearResults:function l(){if(this.widgets.dataTable){var r=this.widgets.dataTable.getRecordSet().getLength();this.widgets.dataTable.deleteRows(0,r)}g.get(this.id+"-search-text").value="";this.singleSelectedUser="";this.selectedUsers={}},onPersonSelect:function h(r,t){var s=t.getData("userName");YAHOO.Bubbling.fire("personSelected",{eventGroup:this,userName:s,firstName:t.getData("firstName"),lastName:t.getData("lastName"),email:t.getData("email")})},onPersonFollow:function o(s,u){var t=u.record.getData("userName");u.button.set("disabled",true);var r=this;Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/follow",method:Alfresco.util.Ajax.POST,dataObj:[t],requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(v){u.button.set("label",r.msg("button.unfollow"));u.button.set("onclick",{fn:r.onPersonUnfollow,obj:{record:u.record,button:u.button},scope:r});r.following[t]=true;u.button.set("disabled",false)},scope:this},failureCallback:{fn:function(w){var v=Alfresco.util.parseJSON(w.serverResponse.responseText);Alfresco.util.PopupManager.displayPrompt({title:this._msg("message.failure"),text:v.message});u.button.set("disabled",false)},scope:this}})},onPersonUnfollow:function a(s,u){var t=u.record.getData("userName");u.button.set("disabled",true);var r=this;Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/unfollow",method:Alfresco.util.Ajax.POST,dataObj:[t],requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(v){u.button.set("label",r.msg("button.follow"));u.button.set("onclick",{fn:r.onPersonFollow,obj:{record:u.record,button:u.button},scope:r});r.following[t]=false;u.button.set("disabled",false)},scope:this},failureCallback:{fn:function(w){var v=Alfresco.util.parseJSON(w.serverResponse.responseText);Alfresco.util.PopupManager.displayPrompt({title:this._msg("message.failure"),text:v.message});u.button.set("disabled",false)},scope:this}})},onSearchClick:function n(s,t){var r=g.get(this.id+"-search-text").value;if(r.replace(/\*/g,"").length<this.options.minSearchTermLength){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.minimum-length",this.options.minSearchTermLength)});return}this.userSelectButtons={};this._performSearch(r)},onPersonSelected:function j(t,r){var v=r[1];if(v&&(v.userName!==undefined)){var u=v.userName;this.selectedUsers[u]=true;this.singleSelectedUser=u;if(this.options.singleSelectMode){for(var s in this.userSelectButtons){if(this.userSelectButtons.hasOwnProperty(s)){this.userSelectButtons[s].set("disabled",true)}}}else{if(this.userSelectButtons[u]){this.userSelectButtons[u].set("disabled",true)}}}},onPersonDeselected:function b(t,r){var u=r[1];if(u&&(u.userName!==undefined)){delete this.selectedUsers[u.userName];this.singleSelectedUser="";if(this.options.singleSelectMode){for(var s in this.userSelectButtons){if(this.userSelectButtons.hasOwnProperty(s)){this.userSelectButtons[s].set("disabled",false)}}}else{if(this.userSelectButtons[u.userName]){this.userSelectButtons[u.userName].set("disabled",false)}}}},_setDefaultDataTableErrors:function q(r){var s=Alfresco.util.message;r.set("MSG_EMPTY",s("message.empty","Alfresco.PeopleFinder"));r.set("MSG_ERROR",s("message.error","Alfresco.PeopleFinder"))},_performSearch:function e(r){if(!this.isSearching){this.isSearching=true;this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.set("MSG_EMPTY",this.msg("message.searching"));this.widgets.dataTable.deleteRows(0,this.widgets.dataTable.getRecordSet().getLength());var s=function u(w,x,y){if(this.options.viewMode!=Alfresco.PeopleFinder.VIEW_MODE_COMPACT){if(g.hasClass(this.id+"-results","hidden")){g.removeClass(this.id+"-results","hidden");g.addClass(this.id+"-help","hidden")}}this._enableSearchUI();this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.onDataReturnInitializeTable.call(this.widgets.dataTable,w,x,y)};var t=function v(x,y){this._enableSearchUI();if(y.status==401){window.location.reload()}else{try{var w=YAHOO.lang.JSON.parse(y.responseText);this.widgets.dataTable.set("MSG_ERROR",w.message);this.widgets.dataTable.showTableMessage(w.message,YAHOO.widget.DataTable.CLASS_ERROR)}catch(z){this._setDefaultDataTableErrors(this.widgets.dataTable)}}};this.searchTerm=r;this.widgets.dataSource.sendRequest(this._buildSearchParams(r),{success:s,failure:t,scope:this});this.widgets.searchButton.set("disabled",true);YAHOO.lang.later(2000,this,function(){if(this.isSearching){if(!this.widgets.feedbackMessage){this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.searching",this.name),spanClass:"wait",displayTime:0})}else{if(!this.widgets.feedbackMessage.cfg.getProperty("visible")){this.widgets.feedbackMessage.show()}}}},[])}},_enableSearchUI:function m(){if(this.widgets.feedbackMessage&&this.widgets.feedbackMessage.cfg.getProperty("visible")){this.widgets.feedbackMessage.hide()}this.widgets.searchButton.set("disabled",false);this.isSearching=false},_buildSearchParams:function k(r){return"filter="+encodeURIComponent(r)+"&maxResults="+this.options.maxSearchResults}})})();(function(){var i=YAHOO.util.Dom;var f=Alfresco.util.encodeHTML;Alfresco.module.DoclibPermissions=function(o){Alfresco.module.DoclibPermissions.superclass.constructor.call(this,"Alfresco.module.DoclibPermissions",o,["button","container","connection","json"]);this.rolePickers={};this.hiddenRoles={};return this};YAHOO.extend(Alfresco.module.DoclibPermissions,Alfresco.component.Base,{options:{siteId:"",roles:null,files:null,width:"44em"},rolePickers:null,hiddenRoles:null,containerDiv:null,showDialog:function g(){this.hiddenRoles={};if(!this.modules.actions){this.modules.actions=new Alfresco.module.DoclibActions()}if(!this.containerDiv){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/permissions",dataObj:{htmlid:this.id,site:this.options.siteId},successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load Document Library Permissions template",execScripts:true})}else{Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.URL_SERVICECONTEXT+"/components/document-details/document-permissions",dataObj:{nodeRef:this.options.files.node.nodeRef,site:this.options.siteId,format:"json"},successCallback:{fn:this.onDataRefresh,scope:this},failureMessage:"Could not refresh permissions",execScripts:true})}},onDataRefresh:function b(o){this.setOptions({siteId:o.json.siteId,files:{displayName:this.options.files.displayName,node:{nodeRef:o.json.nodeRef,permissions:{roles:o.json.roles}}}});this._showDialog()},onTemplateLoaded:function d(p){this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=p.serverResponse.responseText;var t=i.getFirstChild(this.containerDiv);while(t&&t.tagName.toLowerCase()!="div"){t=i.getNextSibling(t)}this.widgets.dialog=Alfresco.util.createYUIPanel(t,{width:this.options.width});this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",this.onOK);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);var s=YAHOO.util.Selector.query("button.site-group",this.widgets.dialog.element),u,o;for(var r=0,q=s.length;r<q;r++){u=s[r].id;o=s[r].value;this.rolePickers[o]=new YAHOO.widget.Button(u,{type:"menu",menu:u+"-select"});this.rolePickers[o].getMenu().subscribe("click",this.onRoleSelected,this.rolePickers[o])}this.widgets.resetAll=Alfresco.util.createYUIButton(this,"reset-all",this.onResetAll);this._showDialog()},onRoleSelected:function n(p,o,q){var r=o[1];q.set("label",r.cfg.getProperty("text"));q.set("name",r.value)},onResetAll:function c(o,p){this._applyPermissions("reset-all")},onOK:function j(p,q){var o=this._parseUI();this._applyPermissions("set",o)},_applyPermissions:function e(r,u){var p,x=[];p=this.options.files;for(var t=0,s=p.length;t<s;t++){x.push(p[t].node.nodeRef)}var w=function v(B){var y,C=B.json.successCount,D=B.json.failureCount;this._hideDialog();if(!B.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.failure")});return}YAHOO.Bubbling.fire("filesPermissionsUpdated",{successCount:C,failureCount:D});for(var A=0,z=B.json.totalResults;A<z;A++){y=B.json.results[A];if(y.success){YAHOO.Bubbling.fire(y.type=="folder"?"folderPermissionsUpdated":"filePermissionsUpdated",{multiple:true,nodeRef:y.nodeRef})}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.success",C)})};var q=function o(y){this._hideDialog();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.failure")})};this.modules.actions.genericAction({success:{callback:{fn:w,scope:this}},failure:{callback:{fn:q,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"permissions/{operation}/site/{site}",params:{site:this.options.siteId,operation:r}},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:x,permissions:u}}});this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},onCancel:function a(o,p){this._hideDialog()},_showDialog:function h(){var t,s;this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false);var q=i.get(this.id+"-title");if(YAHOO.lang.isArray(this.options.files)){q.innerHTML=this.msg("title.multi",this.options.files.length)}else{var o='<span class="light">'+f(this.options.files.displayName)+"</span>";q.innerHTML=this.msg("title.single",o);this.options.files=[this.options.files]}for(var w in this.rolePickers){if(this.rolePickers.hasOwnProperty(w)){this.rolePickers[w].set("name","");this.rolePickers[w].set("label",this.msg("role.None"))}}var r=this.options.files[0].node.permissions.roles,v;for(t=0,s=r.length;t<s;t++){v=r[t].split(";");if(v[1] in this.rolePickers){if(v[2].indexOf("Site")===0){this.rolePickers[v[1]].set("name",v[2]);var p=this.msg("role."+v[2]);if(p==="role."+v[2]){p=v[2]}this.rolePickers[v[1]].set("label",p)}else{this.hiddenRoles[v[1]]={user:v[1],role:v[2]}}}else{if(v[1]!=="GROUP_EVERYONE"||this.options.isSitePublic){this.hiddenRoles[v[1]]={user:v[1],role:v[2]}}}}var u=new YAHOO.util.KeyListener(document,{keys:YAHOO.util.KeyListener.KEY.ESCAPE},{fn:function(y,x){this.onCancel()},scope:this,correctScope:true});u.enable();this.widgets.dialog.show()},_hideDialog:function k(){var o=i.get(this.id+"-form");Alfresco.util.undoCaretFix(o);this.widgets.dialog.hide()},_parseUI:function l(){var q=[],r;for(var o in this.hiddenRoles){q.push({group:this.hiddenRoles[o].user,role:this.hiddenRoles[o].role})}for(var p in this.rolePickers){if(this.rolePickers.hasOwnProperty(p)){r=this.rolePickers[p].get("name");if(r&&r!=="None"){q.push({group:this.rolePickers[p].get("value"),role:r})}}}return q}});var m=new Alfresco.module.DoclibPermissions("null")})();(function(){var h=YAHOO.util.Dom,o=YAHOO.util.Event;var e=Alfresco.util.encodeHTML;Alfresco.module.DoclibAspects=function(p){Alfresco.module.DoclibAspects.superclass.constructor.call(this,p,["button","container","datasource","datatable"]);this.eventGroup=p;this.currentValues=[];this.selectedValues={};return this};YAHOO.extend(Alfresco.module.DoclibAspects,Alfresco.module.SimpleDialog,{currentValues:null,selectedValues:null,setOptions:function g(p){Alfresco.module.DoclibAspects.superclass.setOptions.call(this,{width:"50em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/aspects",doBeforeDialogShow:{fn:this.doBeforeDialogShow,obj:null,scope:this},doBeforeAjaxRequest:{fn:this.doBeforeAjaxRequest,obj:null,scope:this}});this.options=YAHOO.lang.merge(this.options,p);return this},renderItem:function b(r,q){var p=function(w,y,x){var t="";if(w.toLowerCase()=="icon"){var v="",s="",u;if(x&&x.length>0){u=x.split(" ");v=' width="'+u[0]+'"';if(u.length>1){s=' height="'+u[1]+'"'}}t='<img src="'+y+'"'+v+s+' alt="'+e(r.name)+'" title="'+e(r.name)+'" />'}else{t=e(y)}return t};return YAHOO.lang.substitute(q,r,p)},i18n:function m(p,q){return this.msg("aspect."+p.replace(":","_"))},doBeforeDialogShow:function j(q,s,r){var p='<span class="light">'+e(this.options.file.displayName)+"</span>";h.get(this.id+"-title").innerHTML=this.msg("title",p);if(!this.modules.actions){this.modules.actions=new Alfresco.module.DoclibActions(Alfresco.doclib.MODE_REPOSITORY)}this._createAspectsControls();this._requestAspectData();this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)},doBeforeAjaxRequest:function a(s){var q=function r(u){this.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg(u.json.overallSuccess?"message.aspects.success":"message.aspects.failure")});if(u.json.results[0].tagScope){}};var t=function p(u){this.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.aspects.failure")})};this.modules.actions.genericAction({success:{event:{name:"metadataRefresh",obj:{highlightFile:this.options.file.name}},callback:{fn:q,scope:this}},failure:{callback:{fn:t,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"aspects/node/{nodeRef}",params:{nodeRef:this.options.file.jsNode.nodeRef.uri}},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{added:this.getAddedValues(),removed:this.getRemovedValues()}}});return false},getAddedValues:function n(){var r=[],p=Alfresco.util.arrayToObject(this.currentValues);for(var q in this.selectedValues){if(this.selectedValues.hasOwnProperty(q)){if(!(q in p)){r.push(q)}}}return r},getRemovedValues:function l(){var r=[],p=Alfresco.util.arrayToObject(this.currentValues);for(var q in p){if(p.hasOwnProperty(q)){if(!(q in this.selectedValues)){r.push(q)}}}return r},_createAspectsControls:function k(){var w=this;var u=function u(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");A.innerHTML=w.renderItem(z.getData(),"<div>{icon 16 16}</div>")};var x=function x(A,z,B,C){A.innerHTML=w.renderItem(z.getData(),'<h3 class="name">{name}</h3>')};var p=function p(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");if(z.getData("canAdd")){A.innerHTML='<a href="#" class="add-item add-'+w.eventGroup+'" title="'+w.msg("button.add")+'"><span class="addIcon">&nbsp;</span></a>'}};var s=function s(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");if(z.getData("canRemove")){A.innerHTML='<a href="#" class="remove-item remove-'+w.eventGroup+'" title="'+w.msg("button.remove")+'"><span class="removeIcon">&nbsp;</span></a>'}};this.widgets.dataSourceLeft=new YAHOO.util.DataSource([],{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var v=[{key:"icon",label:"icon",sortable:false,formatter:u,width:10},{key:"name",label:"name",sortable:false,formatter:x},{key:"id",label:"add",sortable:false,formatter:p,width:16}];this.widgets.dataTableLeft=new YAHOO.widget.DataTable(this.id+"-left",v,this.widgets.dataSourceLeft,{MSG_EMPTY:this.msg("label.loading")});var r=function q(C,B){var z=YAHOO.Bubbling.getOwnerByTagName(B[1].anchor,"div");if(z!==null){var E=B[1].target,D=E.offsetParent,A=w.widgets.dataTableLeft.getRecord(D);if(A){w.widgets.dataTableRight.addRow(A.getData());w.selectedValues[A.getData("id")]=A;w.widgets.dataTableLeft.deleteRow(D)}}return true};YAHOO.Bubbling.addDefaultAction("add-"+this.eventGroup,r);this.widgets.dataSourceRight=new YAHOO.util.DataSource([],{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var t=[{key:"icon",label:"icon",sortable:false,formatter:u,width:10},{key:"name",label:"name",sortable:false,formatter:x},{key:"id",label:"remove",sortable:false,formatter:s,width:16}];this.widgets.dataTableRight=new YAHOO.widget.DataTable(this.id+"-right",t,this.widgets.dataSourceRight,{MSG_EMPTY:this.msg("label.loading")});var y=function y(C,B){var z=YAHOO.Bubbling.getOwnerByTagName(B[1].anchor,"div");if(z!==null){var E=B[1].target,D=E.offsetParent,A=w.widgets.dataTableRight.getRecord(D);if(A){w.widgets.dataTableLeft.addRow(A.getData());delete w.selectedValues[A.getData("id")];w.widgets.dataTableRight.deleteRow(D)}}return true};YAHOO.Bubbling.addDefaultAction("remove-"+this.eventGroup,y)},_requestAspectData:function f(){this.selectedValues={};Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/aspects/node/"+this.options.file.jsNode.nodeRef.uri,successCallback:{fn:this._requestAspectDataSuccess,scope:this},failureCallback:{fn:this._requestAspectDataFailure,scope:this}})},_requestAspectDataFailure:function i(){this.widgets.dataTableLeft.set("MSG_EMPTY",this.msg("label.load-failure"));this.widgets.dataTableRight.set("MSG_EMPTY",this.msg("label.load-failure"))},_requestAspectDataSuccess:function c(s){this.currentValues={};if(typeof s.json!="undefined"){var r=s.json.current,p=Alfresco.util.arrayToObject(r),C=this.options.visible,B=Alfresco.util.arrayToObject(C),y=this.options.addable,t=this.options.removeable,u,A;this.currentValues=r;if(y.length===0){y=C.slice(0)}this._googleDocsFilter(y);if(t.length===0){t=C.slice(0)}var w=Alfresco.util.arrayToObject(y),q=Alfresco.util.arrayToObject(t);var x,z,v;for(u=0,A=r.length;u<A;u++){x=r[u];v={id:x,icon:Alfresco.constants.URL_RESCONTEXT+"components/images/aspect-16.png",name:this.i18n(x),canAdd:x in w,canRemove:x in q};if(x in B){this.widgets.dataTableRight.addRow(v)}this.selectedValues[x]=v}for(u=0,A=y.length;u<A;u++){z=y[u];if((z in B)&&!(z in p)){this.widgets.dataTableLeft.addRow({id:z,icon:Alfresco.constants.URL_RESCONTEXT+"components/images/aspect-16.png",name:this.i18n(z),canAdd:true,canRemove:true})}}this.widgets.dataTableLeft.set("MSG_EMPTY",this.msg("label.no-addable"));this.widgets.dataTableRight.set("MSG_EMPTY",this.msg("label.no-current"));this.widgets.dataTableLeft.render();this.widgets.dataTableRight.render()}},_googleDocsFilter:function d(u){var r={"text/plain":true,"application/msword":true,"application/vnd.ms-excel":true,"application/vnd.ms-powerpoint":true},p=this.options.file.node.mimetype;if(!r.hasOwnProperty(p)){var q=function q(y,x,w){var v=y.slice((w||x)+1||y.length);y.length=x<0?y.length+x:x;return y.push.apply(y,v)};for(var s=0,t=u.length;s<t;s++){if(u[s]=="gd:googleEditable"){q(u,s);break}}}}})})();var doclibAspects=new Alfresco.module.DoclibAspects("null");(function(){var b=YAHOO.util.Dom,v=YAHOO.util.Event,s=YAHOO.util.Selector,p=YAHOO.util.KeyListener;Alfresco.module.socialPublishing=function(y){this.name="Alfresco.module.socialPublishing";this.id=y;var x=Alfresco.util.ComponentManager.get(this.id);if(x!==null){throw new Error("An instance of Alfresco.module.socialPublishing already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container"],this.onComponentsLoaded,this);return this};Alfresco.module.socialPublishing.prototype={defaultShowConfig:{nodeRef:null,filename:null},showConfig:{},widgets:{},updateLimits:{},onComponentsLoaded:function e(){if(this.id===null){return}},setUpdateLimits:function m(x){this.updateLimits=x;return this},show:function u(x){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,x);if(this.showConfig.nodeRef===undefined||this.showConfig.filename===undefined){throw new Error("A nodeRef & filename must be provided")}if(this.widgets.panel){this.widgets.panel.destroy}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/social-publishing?nodeRef="+this.showConfig.nodeRef+"&htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:Alfresco.util.message("socialPublish.template.error",this.name),execScripts:true});this.widgets.escapeListener=new p(document,{keys:p.KEY.ESCAPE},{fn:this.onCancelButtonClick,scope:this,correctScope:true})},onTemplateLoaded:function d(x){if(x.serverResponse.responseText.indexOf(this.id)===-1){Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("socialPublish.noChannels")});return}var z=document.createElement("div");z.innerHTML=x.serverResponse.responseText;var y=YAHOO.util.Dom.getFirstChild(z);this.widgets.panel=Alfresco.util.createYUIPanel(y);this.widgets.panel.nodeRef=this.showConfig.nodeRef;this.widgets.selectChannelButton=new YAHOO.widget.Button(this.id+"-channel-select-button",{type:"menu",menu:this.id+"-publishChannel-menu",lazyloadmenu:false});this.widgets.selectStatusUpdateChannels=new YAHOO.widget.Button(this.id+"-statusSelect-button",{type:"menu",menu:this.id+"-statusSelect-menu",lazyloadmenu:false});this.widgets.headerText=b.get(this.id+"-header-span");this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this.widgets.publishButton=Alfresco.util.createYUIButton(this,"publish-button",this.onPublishButtonClick);this.widgets.formContainer=b.get(this.id+"-publish-form");this.widgets.statusUpdateText=b.get(this.id+"-statusUpdate-text");this.widgets.statusUpdateCount=b.get(this.id+"-statusUpdate-count");this.widgets.statusUpdateCountMsg=b.get(this.id+"-statusUpdate-countMessage");this.widgets.statusUpdateChannelCount=b.get(this.id+"-statusUpdate-channel-count");this.widgets.statusUpdateCountURL=b.get(this.id+"-statusUpdate-count-urlMessage");this.widgets.statusUpdateCheckboxes=b.getElementsByClassName("statusUpdate-checkboxes","input",this.widgets.formContainer);this.widgets.statusUpdateUrlCheckbox=b.get(this.id+"-statusUpdate-checkbox-url");v.addListener(this.widgets.statusUpdateText,"keydown",this.onStatusUpdateKeypress,{},this);v.addListener(this.widgets.statusUpdateText,"keyup",this.onStatusUpdateKeypress,{},this);v.addListener(this.widgets.statusUpdateCheckboxes,"click",this.onStatusCheckboxToggle,{},this);v.addListener(b.get(this.id+"-publishChannel-menu"),"click",this.onSelectPublishChannel,{},this);v.addListener(b.get(this.id+"-statusSelectActionAll"),"click",this.onSelectAllStatusChannels,{},this);v.addListener(b.get(this.id+"-statusSelectActionNone"),"click",this.onSelectNoStatusChannels,{},this);v.addListener(this.widgets.statusUpdateUrlCheckbox,"click",this.onStatusURLToggle,{},this);this._showPanel()},onCancelButtonClick:function k(){this.closeDialogue()},onPublishButtonClick:function l(){var x=this.widgets.selectChannelButton.get("value"),B={channelId:x,publishNodes:[this.showConfig.nodeRef],statusUpdate:{}},A=this,z=[];includeStatus=false;for(var y=0;y<this.widgets.statusUpdateCheckboxes.length;y++){if(this.widgets.statusUpdateCheckboxes[y].checked){z.push(this.widgets.statusUpdateCheckboxes[y].value);includeStatus=true}}if(includeStatus){B.statusUpdate={message:this.widgets.statusUpdateText.value,channelIds:z};if(this.widgets.statusUpdateUrlCheckbox.checked){B.statusUpdate.nodeRef=this.showConfig.nodeRef}}var D=function C(F){var G=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentPublishing");if(G!==null){G.doRefresh()}var I=A.showConfig.filename,E=this.widgets.selectChannelButton.getAttributeConfig("label").value,H=Alfresco.constants.URL_PAGECONTEXT+"site/"+Alfresco.constants.SITE+"/document-details?nodeRef="+A.showConfig.nodeRef;linkText=Alfresco.util.message("socialPublish.confirm.link",A.name,{"0":I}),linkHTML="<a href='"+H+"'>"+linkText+"</a>",channelHTML="<span class='channel'>"+E+"</span>",trackingText=Alfresco.util.message("socialPublish.confirm.track",A.name,{"0":linkHTML}),successText=Alfresco.util.message("socialPublish.confirm.success",A.name,{"0":I,"1":channelHTML}),balloonHTML="<div class='publishConfirm'><div class='success'>"+successText+"</div>",doclib=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");if(doclib){balloonElement=s.query("input[value="+this.showConfig.nodeRef+"]",document.getElementById(doclib.id),true);balloonHTML+="<div class='tracking'>"+trackingText+"</div>"}else{balloonElement=b.getElementsByClassName("node-thumbnail")[0]}balloonHTML+="</div>";if(balloonElement){balloon=Alfresco.util.createBalloon(balloonElement,{html:balloonHTML,width:"48em"});balloon.show();YAHOO.lang.later(10000,this,function(){balloon.hide()})}};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/publishing/queue",method:Alfresco.util.Ajax.POST,requestContentType:"application/json",responseContentType:"application/json",dataObj:B,successCallback:{fn:D,scope:this},failureMessage:Alfresco.util.message("socialPublish.confirm.failure",this.name)});this.closeDialogue()},closeDialogue:function w(){this.resetTruncationMsg();this.widgets.panel.hide();this.widgets.escapeListener.disable()},onStatusUpdateKeypress:function q(){this.checkUpdateLength()},onStatusCheckboxToggle:function r(x){Alfresco.util.toggleClass(b.getAncestorByClassName(v.getTarget(x),"status-channel"),"selected");this.onSelectedStatusChannelChange()},onSelectAllStatusChannels:function f(z){for(var x in this.widgets.statusUpdateCheckboxes){var y=this.widgets.statusUpdateCheckboxes[x];y.checked=true;b.addClass(b.getAncestorByClassName(y,"status-channel"),"selected")}this.onSelectedStatusChannelChange();v.preventDefault(z)},onSelectNoStatusChannels:function n(z){for(var x in this.widgets.statusUpdateCheckboxes){var y=this.widgets.statusUpdateCheckboxes[x];y.checked=false;b.removeClass(b.getAncestorByClassName(y,"status-channel"),"selected")}this.onSelectedStatusChannelChange();v.preventDefault(z)},onSelectedStatusChannelChange:function a(){this.resetTruncationMsg();this.checkUpdateLength();var x=s.filter(this.widgets.statusUpdateCheckboxes,":checked").length;this.widgets.statusUpdateChannelCount.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.select.count",this.name,{"0":x,"1":this.widgets.statusUpdateCheckboxes.length});if(x>0){this.widgets.statusUpdateText.removeAttribute("disabled");this.widgets.statusUpdateUrlCheckbox.removeAttribute("disabled")}else{b.setAttribute(this.widgets.statusUpdateText,"disabled","disabled");b.setAttribute(this.widgets.statusUpdateUrlCheckbox,"disabled","disabled")}},onStatusURLToggle:function o(){this.checkUpdateLength()},onSelectPublishChannel:function i(y,z){var x=v.getTarget(y);if(!s.test(x,"a.publishChannel")){x=b.getAncestorByClassName(x,"publishChannel")}this.widgets.selectChannelButton.set("label",x.innerHTML);this.widgets.selectChannelButton.set("value",x.rel);v.preventDefault(y)},checkUpdateLength:function h(){var z=null,D=0,y=0,F=s.filter(this.widgets.statusUpdateCheckboxes,":checked"),C={};if(F.length>0){for(var A=0;A<F.length;A++){var x=parseInt(b.getAttribute(F[A],"rel"),10),B=b.getAttribute(F[A],"name");if(x>0&&(x<z||z===null)){z=x}if(C[B]===undefined&&x!==0){C[B]=x}}if(z!==null){if(this.widgets.statusUpdateUrlCheckbox.checked){var G=parseInt(b.getAttribute(this.widgets.statusUpdateUrlCheckbox,"rel"),10);D=D+G;this.widgets.statusUpdateCountURL.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.urlChars",this.name,{"0":G})}else{this.widgets.statusUpdateCountURL.innerHTML=""}D=D+this.widgets.statusUpdateText.value.length;y=z-D;this.widgets.statusUpdateCount.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.charsRemaining",this.name,{"0":y});this.widgets.statusUpdateCountMsg.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.countMessage",this.name);if(y<0){b.addClass(b.getAncestorByClassName(this.widgets.statusUpdateCount,"statusUpdate-count-container","div"),"warning");var E=[];for(var A in C){if(parseInt(C[A],10)<D){E.push(A)}}this.showTruncationMsg(E)}else{this.resetTruncationMsg();b.removeClass(b.getAncestorByClassName(this.widgets.statusUpdateCount,"statusUpdate-count-container","div"),"warning")}}else{this.widgets.statusUpdateCount.innerHTML=this.widgets.statusUpdateCountURL.innerHTML=""}}else{this.widgets.statusUpdateCount.innerHTML=this.widgets.statusUpdateCountURL.innerHTML=this.widgets.statusUpdateCountMsg=""}},showTruncationMsg:function j(y){if(this.widgets.truncationNotification===null||this.widgets.truncationNotification.truncationChannels.length!==y.length){this.resetTruncationMsg();var x=(y.length>1)?"plural":"singular";this.widgets.truncationNotification=Alfresco.util.createBalloon(this.widgets.statusUpdateText,{text:Alfresco.util.message("socialPublish.dialogue.statusUpdate.truncationMessage."+x,this.name,{"0":y.join(", ")}),width:"24em"});this.widgets.truncationNotification.truncationChannels=y;this.widgets.truncationNotification.show()}},resetTruncationMsg:function t(){if(this.widgets.truncationNotification){this.widgets.truncationNotification.hide()}this.widgets.truncationNotification=null},_applyConfig:function c(){var x=Alfresco.util.message("socialPublish.dialogue.header",this.name,{"0":"<strong>"+this.showConfig.filename+"</strong>"});this.widgets.headerText.innerHTML=x;this.widgets.cancelButton.set("disabled",false)},_showPanel:function g(){this._applyConfig();this.widgets.escapeListener.enable();this.widgets.panel.show()}}})();Alfresco.module.getSocialPublishingInstance=function(){var a="alfresco-socialPublishing-instance";return Alfresco.util.ComponentManager.get(a)||new Alfresco.module.socialPublishing(a)};(function(){var d=YAHOO.util.Dom,j=YAHOO.util.Event;Alfresco.module.DoclibCloudFolder=function(o){Alfresco.module.DoclibCloudFolder.superclass.constructor.call(this,o);this.name="Alfresco.module.DoclibCloudFolder";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,{allowedViewModes:[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE],targetNetwork:"-default-",targetUserid:"",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/cloud-folder",sitesAPITemplate:Alfresco.constants.PROXY_URI+"cloud/people/{userid}/sites?network={network}",containersAPITemplate:Alfresco.constants.PROXY_URI+"cloud/doclib/containers/?network={network}",treeNodeAPITemplate:"cloud/doclib/treenode/site/{site}/{container}{path}?children={evaluateChildFoldersSite}&max={maximumFolderCountSite}&network={network}",templateFailMessage:Alfresco.util.message("message.sync.unavailable"),syncOptions:{},mode:"sync"});this.updateAPIURLs();if(o!="null"){YAHOO.Bubbling.on("networkSelected",this._populateSitePicker,this);YAHOO.Bubbling.on("authDetailsAvailable",this.onAuthDetailsAvailable,this)}return this};YAHOO.extend(Alfresco.module.DoclibCloudFolder,Alfresco.module.DoclibGlobalFolder,{onTemplateLoaded:function k(o){if(o.serverResponse.status===204){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.message.no.active.network")})}else{Alfresco.module.DoclibCloudFolder.superclass.onTemplateLoaded.call(this,o)}},_selectionIncludesFolder:function a(){var p=this.options.files;if(YAHOO.lang.isArray(p)){for(var o in p){if(p[o].jsNode.isContainer){return true}}return false}else{return p.jsNode.isContainer}},_beforeShowDialog:function b(){Alfresco.module.DoclibCloudFolder.superclass._beforeShowDialog.call(this);this.widgets.optionInputs=d.getElementsByClassName("cloudSyncOption","input",this.id+"-wrapper");var p=this.widgets.optionInputs;for(var o in p){if(!this._selectionIncludesFolder()&&p[o].id==="includeSubFolders"){d.addClass(d.get(p[o].id+"-label"),"hidden");break}else{if(d.hasClass(d.get(p[o].id+"-label"),"hidden")){d.removeClass(d.get(p[o].id+"-label"),"hidden");break}}}},_showDialog:function m(){Alfresco.module.DoclibCloudFolder.superclass._showDialog.call(this);if(!this.widgets.networkButtons){this.widgets.networkButtons=new YAHOO.widget.ButtonGroup(this.id+"-networkGroup");this.widgets.networkButtons.on("checkedButtonChange",this.onNetworkSelect,this.widgets.networkButtons,this)}this.onNetworkSelect(null,this.widgets.networkButtons);j.on(d.getElementsByClassName("cloud-path-add-folder","div"),"click",function o(p){j.preventDefault(p);this.createFolderInTheCloud()},{},this)},createFolderInTheCloud:function h(){if(!this.options.createFolderInTheCloudDialog){var r=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"type",itemId:"cm:folder",mode:"create",submitType:"json",formId:"doclib-common"});var p=function q(v,w){d.get(w.id+"-dialogTitle").innerHTML=this.msg("sync.new-folder.in-the-cloud.title");d.get(w.id+"-dialogHeader").innerHTML=this.msg("sync.new-folder.in-the-cloud.header")};var u=function s(v){this.widgets.cancelButton.set("disabled",false)};var t=function o(B){var C=(this.selectedNode.data.nodeRef).replace(":/","");var x="";var A=this.widgets.networkButtons.getButtons();for(var y in A){if(A[y].get("checked")){x=A[y]._button.innerHTML;break}}var w=YAHOO.lang.substitute(Alfresco.constants.PROXY_URI+"cloud/node/folder/{destination}?network={network}",{destination:C,network:x});var v={name:B.dataObj.prop_cm_name,title:B.dataObj.prop_cm_title,description:B.dataObj.prop_cm_description};Alfresco.util.Ajax.jsonPost({url:w,dataObj:v,successCallback:{fn:function z(E){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.new-folder.creation.success"),displayTime:0.5});var I="/";var J=this.selectedNode.data.path.split(I);J=Alfresco.util.arrayRemove(J,"");J.push(E.config.dataObj.name);var H="";this.pathsToExpand=[];for(var G=0,F=J.length;G<F;G++){H+=I+J[G];this.pathsToExpand.push(H)}YAHOO.Bubbling.fire("siteChanged",{site:this.options.siteId,siteTitle:this.options.siteTitle,eventGroup:this,scrollTo:true})},scope:this},failureCallback:{fn:function D(E){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.new-folder.creation.failure")})},scope:this}})};this.options.createFolderInTheCloudDialog=new Alfresco.module.SimpleDialog(this.id+"-createFolderInTheCloud");this.options.createFolderInTheCloudDialog.setOptions({width:"33em",templateUrl:r,actionUrl:null,clearForm:true,doBeforeFormSubmit:{fn:u,scope:this},doBeforeDialogShow:{fn:p,scope:this},doBeforeAjaxRequest:{fn:t,scope:this}})}this.options.createFolderInTheCloudDialog.show()},setViewMode:function i(o){this.options.viewMode=o;d.removeClass(this.id+"-wrapper","repository-mode")},onNetworkSelect:function f(p,o){this.options.targetNetwork=o.get("checkedButton").get("name");this.updateAPIURLs();this.options.siteId=null;YAHOO.Bubbling.fire("networkSelected")},updateAPIURLs:function c(){var o={network:this.options.targetNetwork,userid:this.options.targetUserid};this.options.sitesAPI=YAHOO.lang.substitute(this.options.sitesAPITemplate,o);this.options.containersAPI=YAHOO.lang.substitute(this.options.containersAPITemplate,o);this.options.siteTreeContainerTypes={"cm:folder":{uri:YAHOO.lang.substitute(this.options.treeNodeAPITemplate,o)}}},updateSyncOptions:function g(){for(var o=0;o<this.widgets.optionInputs.length;o++){var q=d.getAttribute(this.widgets.optionInputs[o],"value"),p=d.getAttribute(this.widgets.optionInputs[o],"checked");this.options.syncOptions[q]=p}},onExpandComplete:function e(p){if(this.pathsToExpand!=null){var o=this.widgets.treeview.getNodeByProperty("path",this.pathsToExpand.shift());if(o!=null){o.expand();this._updateSelectedNode(o)}}},onAuthDetailsAvailable:function n(p,o){this.options.targetUserid=o[1].authDetails.username}});var l=new Alfresco.module.DoclibCloudFolder("null")})();(function(){var f=YAHOO.util.Dom,a=YAHOO.util.KeyListener;Alfresco.module.CloudAuth=function(p){Alfresco.module.CloudAuth.superclass.constructor.call(this,p);this.name="Alfresco.module.CloudAuth";Alfresco.util.ComponentManager.reregister(this);if(p!="null"){this.eventGroup=p}return this};YAHOO.extend(Alfresco.module.CloudAuth,Alfresco.component.Base,{options:{getAuthURL:Alfresco.constants.PROXY_URI+"cloud/person/credentials"},authDetails:{},isAuthenticated:function b(){return(typeof(this.getAuthUser())!=="undefined")?true:false},checkAuth:function l(){var p=this.displayPrompt;YAHOO.Bubbling.on("authDetailsAvailable",this.onAuthDetailsAvailable,this);Alfresco.util.Ajax.jsonGet({url:this.options.getAuthURL,successCallback:{fn:function q(r){if(r.json!==undefined){this.authDetails=r.json;YAHOO.Bubbling.fire("authDetailsAvailable",{authDetails:this.authDetails})}},scope:this},failureMessage:"Error checking cloud authentication details"})},getAuthUser:function o(){return this.authDetails.username},onAuthDetailsAvailable:function c(){YAHOO.Bubbling.unsubscribe("authDetailsAvailable",this.onAuthDetailsAvailable,this);if(this.isAuthenticated()){this.callAuthCallback()}else{this.displayPrompt()}},displayPrompt:function h(){this.options.formId=this.id+"-authForm";Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"cloud/cloud-auth-form?htmlid="+this.options.formId,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load html template for cloud authentication",execScripts:true});this.widgets.escapeListener=new a(document,{keys:a.KEY.ESCAPE},{fn:this.onCancel,scope:this,correctScope:true})},onTemplateLoaded:function i(p){var q=document.createElement("div");q.innerHTML=p.serverResponse.responseText;this.widgets.panel=Alfresco.util.createYUIPanel(q,{width:"498px"});this._showPanel();this.setUpForm()},_showPanel:function m(p){this.widgets.escapeListener.enable();this.widgets.panel.show();if(p){f.addClass(f.get(this.options.formId+"-form"),"show-error")}},callAuthCallback:function j(){this.options.authCallback.apply(this.options.authCallbackContext)},setUpForm:function e(){this.widgets.ok=Alfresco.util.createYUIButton(this,"authForm-button-ok",null,{type:"submit"});this.widgets.cancel=Alfresco.util.createYUIButton(this,"authForm-button-cancel",this.onCancel);var q=new Alfresco.forms.Form(this.id+"-authForm-form");q.setSubmitElements(this.widgets.ok);q.setSubmitAsJSON(true);q.setAJAXSubmit(true,{successCallback:{fn:this.onFormSubmitSuccess,scope:this},failureCallback:{fn:this.onFormSubmitFailure,scope:this}});q.doBeforeFormSubmit={fn:function p(){Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("label.validating")})},scope:this};q.init()},onCancel:function d(){this.destroy()},onFormSubmitSuccess:function g(p){if(p.json.loginValid===true){YAHOO.Bubbling.fire("authDetailsAvailable",{authDetails:p.json});this.callAuthCallback()}else{if(p.json.loginValid===false&&p.json.remoteSystemAvailable===true){this._showPanel(true)}else{this.onFormSubmitFailure(p)}}},onFormSubmitFailure:function k(p){Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("label.validationError")})}});var n=new Alfresco.module.CloudAuth("null")})();