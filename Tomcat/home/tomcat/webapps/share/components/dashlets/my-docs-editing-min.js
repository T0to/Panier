(function(){var c=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML;$siteURL=Alfresco.util.siteURL;Alfresco.dashlet.MyDocsEditing=function b(f){Alfresco.dashlet.MyDocsEditing.superclass.constructor.call(this,"Alfresco.dashlet.MyDocsEditing",f);return this};YAHOO.extend(Alfresco.dashlet.MyDocsEditing,Alfresco.component.Base,{onReady:function d(){Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/doclist/documents/node/alfresco/sites/home?filter=editingMe&max=3",successCallback:{fn:function(g){var m=c.get(this.id+"-documents"),t=c.get(this.id+"-document-template"),p=g.json.items,o="onerror=\"this.src='"+Alfresco.constants.URL_CONTEXT+"res/components/images/filetypes/generic-file-32.png'\"";if(p.length!==0){var s=unescape(t.innerHTML);for(var l=0,h=p.length,r,u;l<h;l++){u=p[l];var q=$siteURL("dashboard",{site:u.location.site}),n=u.fileName.lastIndexOf("."),v=n!==-1?u.fileName.substring(n+1):"generic",k=this.msg("details.editing-started-in-site",'<span class="relativeTime">'+Alfresco.util.relativeTime(u.modifiedOn)+"</span>",'<a class="theme-color-1 site-link" href="'+q+'">'+a(u.location.siteTitle)+"</a>");var f={name:a(u.displayName),filename:encodeURIComponent(u.fileName),fileExt:v,site:u.location.site,editingMessage:k,onerror:o};r=t.cloneNode(true);r.innerHTML=YAHOO.lang.substitute(s,f);m.appendChild(r)}}else{m.innerHTML='<div class="detail-list-item first-item"><span class="faded">'+this.msg("label.noItems")+"</span>"}c.addClass(this.id+"-documents-wait","hidden");c.removeClass(m,"hidden")},scope:this},failureCallback:{fn:function(f){c.addClass(this.id+"-documents-wait","hidden");var g=c.get(this.id+"-message");g.innerHTML+="<p>"+a(f.json.message);+"</p>";c.removeClass(g,"hidden")},scope:this}});Alfresco.util.Ajax.jsonRequest({url:Alfresco.constants.PROXY_URI+"slingshot/dashlets/my-contents",successCallback:{fn:function(g){var f=g.json,h=c.get(this.id+"-item-template");this.renderContentItems(f.blogPosts.items,"-blogposts","blog-postview?postId=","blogpost-32.png",h);this.renderContentItems(f.wikiPages.items,"-wikipages","wiki-page?title=","wikipage-32.png",h);this.renderContentItems(f.forumPosts.items,"-forumposts","discussions-topicview?topicId=","topicpost-32.png",h);c.getElementsByClassName("relativeTime","span",c.get("myEditingDocsDashlet"),function(){this.innerHTML=Alfresco.util.relativeTime(this.innerHTML)})},scope:this},failureCallback:{fn:function(f){c.addClass(this.id+"-content-wait","hidden");var g=c.get(this.id+"-message");g.innerHTML+="<p>"+a(f.json.message);+"</p>";c.removeClass(g,"hidden")},scope:this}})},renderContentItems:function e(o,s,g,t,u){var m=c.get(this.id+s),n="components/images/"+t;if(o.length!==0){var r=unescape(u.innerHTML);for(var l=0,h=o.length,q,v;l<h;l++){v=o[l];var p=$siteURL("dashboard",{site:v.site.shortName}),k=this.msg("text.edited-on",'<span class="relativeTime">'+Alfresco.util.relativeTime(v.modifiedOn)+"</span>",'<a class="theme-color-1 site-link" href="'+p+'">'+a(v.site.title)+"</a>");var f={name:a(v.displayName),icon:n,browseURL:$siteURL(g,{site:v.site.shortName})+encodeURIComponent(v.name),editingMessage:k};q=u.cloneNode(true);q.innerHTML=YAHOO.lang.substitute(r,f);m.appendChild(q)}}else{m.innerHTML='<div class="detail-list-item first-item"><span class="faded">'+this.msg("label.noItems")+"</span>"}c.addClass(this.id+"-content-wait","hidden");c.removeClass(m,"hidden")}})})();