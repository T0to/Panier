<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="alfresco.avm.insert">
    
    <!--NOTE: MyBatis #224 - eg. Oracle -->
    
    <!--MyBatis #224 -->
    <parameterMap id="parameter_Node" type="AVMNode">
        <parameter property="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="classType" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="deletedType" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <parameter property="version" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="storeNewId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="aclId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="guid" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="owner" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="creator" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="createdDate" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="modifier" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="modifiedDate" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="accessDate" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="isRoot" jdbcType="BIT" javaType="java.lang.Boolean"/>
        <parameter property="layerId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="indirection" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="indirectionVersion" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <parameter property="primaryIndirection" jdbcType="BIT" javaType="java.lang.Boolean"/>
        <parameter property="opacity" jdbcType="BIT" javaType="java.lang.Boolean"/>
        <parameter property="contentUrl" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="mimetype" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="encoding" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="length" jdbcType="BIGINT" javaType="java.lang.Long"/>
    </parameterMap>
    
    <!--MyBatis #224 -->
    <parameterMap id="parameter_AVMVersionRoot" type="AVMVersionRoot">
        <parameter property="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="storeId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="rootNodeId" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="version" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <parameter property="creator" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="createdDate" jdbcType="BIGINT" javaType="java.lang.Long"/>
        <parameter property="tag" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <parameter property="description" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </parameterMap>
    
    <insert id="insert_AVMStore" parameterType="AVMStore">
    
        <selectKey resultType="long" keyProperty="id" order="BEFORE">
            select avm_stores_seq.nextval as value from dual
        </selectKey>
        
        <include refid="alfresco.avm.insert_AVMStore_Sequence"/>
        
    </insert>
    
    <insert id="insert_AVMStoreProperty" parameterMap="alfresco.avm.parameter_IdStorePropertyPatternMap">
    
        <selectKey resultType="long" keyProperty="id" order="BEFORE">
            select avm_store_properties_seq.nextval as value from dual
        </selectKey>
        
        <include refid="alfresco.avm.insert_AVMStoreProperty_Sequence"/>
        
    </insert>
    
    <insert id="insert_AVMNode" parameterMap="parameter_Node">
    
        <selectKey resultType="long" keyProperty="id" order="BEFORE">
            select avm_nodes_seq.nextval as value from dual
        </selectKey>
        
        insert into avm_nodes (id, class_type, deletedType, version_id, vers, store_new_id, acl_id, guid, owner, creator, createDate, lastModifier, modDate, accessDate, is_root, layer_id, indirection, indirection_version, primary_indirection, opacity, content_url, mime_type, encoding, length)
        values (?, ?, ?, ?, 0, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        
    </insert>
    
    <insert id="insert_AVMVersionRoot" parameterMap="parameter_AVMVersionRoot">
    
        <selectKey resultType="long" keyProperty="id" order="BEFORE">
            select avm_version_roots_seq.nextval as value from dual
        </selectKey>
        
        insert into avm_version_roots (id, avm_store_id, root_id, version_id, creator, create_date, tag, description)
        values (?, ?, ?, ?, ?, ?, ?, ?)
        
    </insert>
    
</mapper>