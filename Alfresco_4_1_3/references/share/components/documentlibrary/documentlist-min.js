(function(){var C=YAHOO.util.Dom,P=YAHOO.util.Event,N=YAHOO.util.DragDropMgr;var f=Alfresco.util.encodeHTML,ao=Alfresco.util.activateLinks,aP=Alfresco.util.combinePaths,p=Alfresco.util.userProfileLink,b=Alfresco.util.siteURL,O=function O(ba,bb){return Alfresco.util.formatDate(Alfresco.util.fromISO8601(ba),bb)},af=Alfresco.util.relativeTime,G=Alfresco.util.isValueSet;var a3="org.alfresco.share.documentList",aK=a3+".sortAscending",d=a3+".sortField",ab=a3+".showFolders",U=a3+".simpleView",ad=a3+".viewRendererName";Alfresco.DnD=function(be,bb,ba,bc){Alfresco.DnD.superclass.constructor.call(this,be,ba,bc);var bd=this.getDragEl();C.setStyle(bd,"opacity",0.67);this.docLib=bb};YAHOO.extend(Alfresco.DnD,YAHOO.util.DDProxy,{_inFlight:false,startDrag:function q(bb,be){var ba=this.getDragEl();var bd=this.getEl();C.setStyle(bd,"visibility","hidden");var bc=document.createElement("img");bc.src=bd.src;ba.removeChild(ba.firstChild);ba.appendChild(bc);C.setStyle(ba,"border","none")},endDrag:function am(bc){if(!this._inFlight){var ba=this.getEl();var bb=this.getDragEl();this.animateResult(bb,ba)}},animateResult:function ax(bd,ba){C.setStyle(bd,"visibility","");var bb=new YAHOO.util.Motion(bd,{points:{to:C.getXY(ba)}},0.2,YAHOO.util.Easing.easeOut);var bc=bd.id;var be=this.id;bb.onComplete.subscribe(function(){C.setStyle(bc,"visibility","hidden");C.setStyle(be,"visibility","")});bb.animate()},onDragDrop:function v(be,bg){var bf=C.get(bg);if(N.interactionInfo.drop.length>0){if(C.isAncestor(this.docLib.widgets.dataTable.getContainerEl(),bf)){var ba=this.docLib.widgets.dataTable.getRecord(C.get(bg)),bd=ba.getData();if(bd.node.isContainer){this._inFlight=true;var bb;if(bd.node.isLink){bb=new Alfresco.util.NodeRef(bd.node.linkedNode.nodeRef)}else{bb=new Alfresco.util.NodeRef(bd.node.nodeRef)}this._performMove(bb,bd.location.path+"/"+bd.location.file)}}else{if(C.hasClass(bf,"documentDroppable")){var bc={elementId:bg,callback:this.onDropTargetOwnerCallBack,scope:this};this._inFlight=true;YAHOO.Bubbling.fire("dropTargetOwnerRequest",bc);this._setFailureTimeout()}}}},_performMove:function aw(bf,bi){var bc=this.docLib.widgets.dataTable.getRecord(this.getEl()),bd="move-to/node/{nodeRef}",bh=[];bh.push(this.getEl().id);var bg=function be(bl){this._inFlight=false;var bj,bm=bl.json.successCount,bn=bl.json.failureCount;if(!bl.json.overallSuccess){this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});C.removeClass(this.dragFolderHighlight,"dndFolderHighlight");return}this.docLib._updateDocList.call(this.docLib);var bk=bc.getData();if(bk.node.isContainer){YAHOO.Bubbling.fire("folderMoved",{multiple:true,nodeRef:bk.nodeRef,destination:bi})}};var bb=function ba(bj){this._inFlight=false;this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});C.removeClass(this.dragFolderHighlight,"dndFolderHighlight")};this.docLib.modules.actions.genericAction({success:{callback:{fn:bg,scope:this}},failure:{callback:{fn:bb,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:bd,params:{nodeRef:bf.uri}},wait:{message:this.docLib.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:bh,parentId:this.docLib.doclistMetadata.parent.nodeRef}}})},_currTimeoutId:null,onDropTargetOwnerCallBack:function aC(ba,bc){this._clearTimeout();var bb=new Alfresco.util.NodeRef(ba);this._performMove(bb,bc)},_clearTimeout:function an(){if(this._currTimeoutId!=null){window.clearTimeout(this._currTimeoutId);this._currTimeoutId=null;this._inFlight=false}},_setFailureTimeout:function aS(){this._clearTimeout();var ba=this;this._currTimeoutId=window.setTimeout(function(){ba.animateResult(ba.getDragEl(),ba.getEl());ba._inFlight=false;ba._currTimeoutId=null},500)},onDragOver:function a6(bc,bd){var ba=C.get(bd);if(ba.tagName=="IMG"||ba.className=="droppable"){this.dragFolderHighlight=C.getAncestorByClassName(ba,"folder");C.addClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(C.hasClass(ba,"documentDroppableHighlights")){var bb={elementId:bd,event:bc};YAHOO.Bubbling.fire("documentDragOver",bb)}}},onDragOut:function aT(bc,bd){var ba=C.get(bd);if(ba.tagName=="IMG"||ba.className=="droppable"){this.dragFolderHighlight=C.getAncestorByClassName(ba,"folder");C.removeClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(C.hasClass(ba,"documentDroppableHighlights")){var bb={elementId:bd,event:bc};YAHOO.Bubbling.fire("documentDragOut",bb)}}}});Alfresco.DocumentListViewRenderer=function(ba){this.name=ba;this.parentElementIdSuffix="-documents";this.rowClassName="yui-dt-rec";this.actionsCssClassName=this.name;this.actionsColumnWidth=200;this.actionsSplitAtModifier=1;this.thumbnailColumnWidth=100;this.buttonElementIdSuffix="-"+this.name+"View";this.buttonCssClass=this.name+"-view";this.metadataBannerViewName=this.name;this.metadataLineViewName=this.name;return this};Alfresco.DocumentListViewRenderer.prototype={setupRenderer:function W(ba){C.addClass(ba.id+this.buttonElementIdSuffix,this.buttonCssClass)},renderView:function aA(bc,ba,bb,bd){YAHOO.util.Dom.setStyle(bc.id+this.parentElementIdSuffix,"display","");bc.widgets.dataTable.onDataReturnInitializeTable.call(bc.widgets.dataTable,ba,bb,bd)},destroyView:function aI(bc,ba,bb,bd){YAHOO.util.Dom.setStyle(bc.id+this.parentElementIdSuffix,"display","none")},renderCellSelected:function h(bb,be,bd,bf,bg){C.setStyle(be,"width",bf.width+"px");C.setStyle(be.parentNode,"width",bf.width+"px");var bc=bd.getData("jsNode"),ba=bc.nodeRef;be.innerHTML='<input id="checkbox-'+bd.getId()+'" type="checkbox" name="fileChecked" value="'+ba+'"'+(bb.selectedFiles[ba]?' checked="checked">':">")},renderCellStatus:function z(bl,bj,bm,bf,ba){C.setStyle(bj,"width",bf.width+"px");C.setStyle(bj.parentNode,"width",bf.width+"px");var bd=bm.getData(),bb=bd.jsNode,bi=bd.indicators,bh,bg,be="";if(bi&&bi.length>0){for(var bc=0,bk=bi.length;bc<bk;bc++){bh=bi[bc];bg=Alfresco.util.message(bh.label,bl.name,bh.labelParams);bg=Alfresco.util.substituteDotNotation(bg,bd);be+='<div class="status">';if(bh.action){be+='<a class="indicator-action" data-action="'+bh.action+'">'}be+='<img src="'+Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/indicators/"+bh.icon+'" title="'+bg+'" alt="'+bh.id+'" />';if(bh.action){be+="</a>";be+="</div>"}}}bj.innerHTML=be},renderCellThumbnail:function ac(bn,bm,bo,bi,be){var bh=bo.getData(),bf=bh.jsNode,bk=bf.properties,bb=bh.displayName,bd=bf.isContainer,bg=bf.isLink,bj=bb.substring(bb.lastIndexOf(".")),ba=bf.nodeRef.nodeRef;var bl;bi.width=this.thumbnailColumnWidth;C.setStyle(bm,"width",bi.width+"px");C.setStyle(bm.parentNode,"width",bi.width+"px");if(bd||(bg&&bf.linkedNode.isContainer)){bm.innerHTML='<span class="folder">'+(bg?'<span class="link"></span>':"")+(bn.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(bn,bh)+'<img id="'+ba+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-64.png" /></a>';bl=new YAHOO.util.DDTarget(ba)}else{bm.innerHTML='<span class="thumbnail">'+(bg?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(bn,bh)+'<img id="'+ba+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(bh)+'" alt="'+bj+'" title="'+f(bb)+'" /></a></span>'}var bc=new Alfresco.DnD(ba,bn)},renderCellDescription:function a0(ba,bh,by,bn,bs){var bv="",bu,bt,be=by.getData(),bw=be.jsNode,bi=bw.properties,bj=bw.isContainer,bk=bw.isLink,bC="",bq="",bf="",bg=bw.permissions.user.CreateChildren;if(bw.isLink){by.setData("displayName",ba.msg("details.link-to",be.location.file))}else{if(bi.title&&bi.title!==be.displayName&&ba.options.useTitle){bq='<span class="title">('+f(bi.title)+")</span>"}}if(G(be.version)&&!bw.isContainer&&!bw.isLink){bf='<span class="document-version">'+f(be.version)+"</span>"}be._filenameId=Alfresco.util.generateDomId();var br=be.metadataTemplate;if(br){if(YAHOO.lang.isArray(br.banners)){var bA=function bd(bF,bH,bE){var bD=(bE!==null?ba.msg(bE)+": ":""),bG="";if(ba.renderers.hasOwnProperty(bF)&&typeof ba.renderers[bF]==="function"){bG=ba.renderers[bF].call(ba,be,bD)}else{if(bw.hasProperty(bF)){bG='<span class="item">'+bD+f(bw.properties[bF])+"</span>"}}return bG};var bp,bB;for(bu=0,bt=br.banners.length;bu<bt;bu++){bB=br.banners[bu];if(!G(bB.view)||bB.view==this.metadataBannerViewName){bp=YAHOO.lang.substitute(bB.template,ba.renderers,bA);if(G(bp)){bv+='<div class="info-banner">'+bp+"</div>"}}}}if(YAHOO.lang.isString(br.title)){var bx=function bc(bF,bH,bE){var bD=(bE!==null?"<em>"+ba.msg(bE)+"</em>: ":""),bG="";if(ba.renderers.hasOwnProperty(bF)&&typeof ba.renderers[bF]==="function"){bG=ba.renderers[bF].call(ba,be,bD)}else{if(bw.hasProperty(bF)){bG='<div class="filename">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(ba,be);bG+=bD+f(bw.properties[bF])+"</a></span></div>"}}return bG};bv+=YAHOO.lang.substitute(br.title,ba.renderers,bx)}else{if(bw.hasPermission("Write")&&!bw.isLocked&&!bw.hasAspect("cm:workingcopy")){ba.insituEditors.push({context:be._filenameId,params:{type:"textBox",nodeRef:bw.nodeRef.toString(),name:"prop_cm_name",value:be.fileName,fnSelect:function bm(bE,bF){var bD=bF.lastIndexOf(Alfresco.util.getFileExtension(bF))-1;if(bD>0){Alfresco.util.selectText(bE,0,bD)}else{bE.select()}},validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:ba.msg("validation-hint.nodeName")},{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:ba.msg("validation-hint.length.min.max",1,255)}],title:ba.msg("tip.insitu-rename"),errorMessage:ba.msg("message.insitu-edit.name.failure")},callback:{fn:ba._insituCallback,scope:ba,obj:be}})}bv+='<h3 class="filename"><span id="'+be._filenameId+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(ba,be);bv+=f(be.displayName)+"</a></span>"+bq+bf+"</h3>"}if(YAHOO.lang.isArray(br.lines)){var bz=function bl(bF,bH,bE){var bD=(bE!==null?"<em>"+ba.msg(bE)+"</em>: ":""),bG="";if(ba.renderers.hasOwnProperty(bF)&&typeof ba.renderers[bF]==="function"){bG=ba.renderers[bF].call(ba,be,bD)}else{if(bw.hasProperty(bF)){bG='<span class="item">'+bD+f(bw.properties[bF])+"</span>"}}return bG};var bp,bo;for(bu=0,bt=br.lines.length;bu<bt;bu++){bo=br.lines[bu];if(!G(bo.view)||bo.view==this.metadataLineViewName){bp=YAHOO.lang.substitute(bo.template,ba.renderers,bz);if(G(bp)){bv+='<div class="detail">'+bp+"</div>"}}}}}bh.innerHTML=bv;P.on(C.getElementsByClassName("banner-more-info-link","span",bh),"click",function bb(bD){ba.onCloudSyncIndicatorAction(be,P.getTarget(bD))},{},ba)},renderCellActions:function u(ba,bc,bb,bd,be){bd.width=this.actionsColumnWidth;C.setStyle(bc,"width",bd.width+"px");C.setStyle(bc.parentNode,"width",bd.width+"px");C.addClass(bc.parentNode,bb.getData("type"));bc.innerHTML='<div id="'+ba.id+"-actions-"+bb.getId()+'" class="hidden"></div>'},getDataTableRecordIdFromRowElement:function aV(bb,bc){if(bb!=null&&bc!=null){var ba=bc;if(!C.hasClass(bc,this.rowClassName)){ba=C.getAncestorByClassName(bc,this.rowClassName)}return ba.id}},getRowElementFromDataTableRecord:function aE(ba,bb){if(ba!=null&&bb!=null){return ba.widgets.dataTable.getTrEl(bb)}},getRowSelectElementFromDataTableRecord:function av(ba,bb){if(ba!=null&&bb!=null){return C.get("checkbox-"+bb.getId())}},onEventHighlightRow:function y(bb,bp,be){bb.widgets.dataTable.onEventHighlightRow.call(bb.widgets.dataTable,bp);var bh;if(be){bh=be}else{bh=bp.target}var ba=C.get(bb.id+"-actions-"+bh.id);if(ba&&ba.firstChild===null){var br=bb.widgets.dataTable.getRecord(this.getDataTableRecordIdFromRowElement(bb,bh)),bd=br.getData(),bq=bd.jsNode,bi=bd.actions,bk=document.createElement("div"),bm="",bc;bd.actionParams={};for(var bn=0,bj=bi.length;bn<bj;bn++){bm+=bb.renderAction(bi[bn],bd)}bk.innerHTML=YAHOO.lang.substitute(bm,bb.getActionUrls(bd));C.addClass(bk,"action-set");C.addClass(bk,this.actionsCssClassName);bc=YAHOO.util.Selector.query("div",bk);if(bc.length>bb.options.actionsSplitAt+this.actionsSplitAtModifier){var bf=C.get(bb.id+"-moreActions").cloneNode(true),bo=YAHOO.util.Selector.query("div",bf);C.insertBefore(bo[0],bc[bb.options.actionsSplitAt]);C.insertBefore(bo[1],bc[bb.options.actionsSplitAt]);var bg,bl=bc.slice(bb.options.actionsSplitAt);for(bg in bl){if(bl.hasOwnProperty(bg)){bo[1].appendChild(bl[bg])}}}ba.appendChild(bk)}if(!C.hasClass(document.body,"masked")){bb.currentActionsMenu=ba;C.removeClass(ba,"hidden")}},onEventUnhighlightRow:function ap(bb,be,bd){bb.widgets.dataTable.onEventUnhighlightRow.call(bb.widgets.dataTable,be);var ba;if(bd){ba=bd}else{ba=be.target}var bc=C.get(bb.id+"-actions-"+(ba.id));if(bc||C.hasClass(document.body,"masked")){if(bb.hideMoreActionsFn){bb.hideMoreActionsFn.call(this)}C.addClass(bc,"hidden")}},onActionShowMore:function S(bc,bb,ba){C.addClass(ba.firstChild,"highlighted");var bd=C.getNextSibling(ba);C.removeClass(bd,"hidden");bc.hideMoreActionsFn=function be(){bc.hideMoreActionsFn=null;C.removeClass(ba.firstChild,"highlighted");C.addClass(bd,"hidden")}},onFileRenamed:function aB(bd,bb,ba){var bf=ba[1];if(bf&&(bf.file!==null)){var be=bd._findRecordByParameter(bf.file.node.nodeRef,"nodeRef");if(be!==null){bd.widgets.dataTable.updateRow(be,bf.file);var bc=bd.widgets.dataTable.getTrEl(be);Alfresco.util.Anim.pulse(bc)}}},onHighlightFile:function j(be,bc,bb){var bh=bb[1];if((bh!==null)&&(G(bh.fileName))){Alfresco.logger.debug("DL_VR_onHighlightFile: ",bh.fileName);var bg=be._findRecordByParameter(bh.fileName,"displayName");if(bg!==null){var bd=this.getRowElementFromDataTableRecord(be,bg),bf=C.getY(bd);if(YAHOO.env.ua.ie>0){bf=bf-(document.body.clientHeight/3)}else{bf=bf-(window.innerHeight/3)}window.scrollTo(0,bf);Alfresco.util.Anim.pulse(bd);be.options.highlightFile=null;var ba=this.getRowSelectElementFromDataTableRecord(be,bg);ba.checked=true;be.selectedFiles[bg.getData("nodeRef")]=true;YAHOO.Bubbling.fire("selectedFilesChanged")}}},_setEmptyDataSourceMessage:function L(bb,ba){bb.widgets.dataTable.set("MSG_EMPTY",ba)},renderEmptyDataSourceHtml:function aN(bn,bj){var bk=bn;var bc=bk.doclistMetadata.itemCounts,bg=(bc.documents===0&&bc.folders===0),bi=(bc.documents===0&&!bk.options.showFolders&&bc.folders>0);var bf=function bh(br){var bp=C.getChildren(br);for(var bo=0,bq=bp.length;bo<bq;bo++){if(bp[bo].id!==null&&bp[bo].id!==""){bp[bo].id+="-instance"}}};var bm=C.get(bk.id+"-main-template"),be=bm.cloneNode(true),bb=C.getFirstChild(be),bd=null,ba=null;if(bj){bk._userCanUpload=bk.doclistMetadata.parent.permissions.user.CreateChildren&&YAHOO.env.ua.mobile===null;bk._removeDragAndDrop();if(bk.currentFilter.filterId==="path"){bk._addDragAndDrop()}if(bk._userCanUpload&&bk.dragAndDropEnabled){C.addClass(bb,"docListInstructionsWithDND")}else{C.addClass(bb,"docListInstructions")}if(bg&&!bk._userCanUpload){bm=C.get(bk.id+"-no-items-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bb.appendChild(bd)}else{if(bi){bm=C.get(bk.id+"-hidden-subfolders-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bf(bd);ba=C.getElementsByClassName("docListLinkedInstruction","a",bd);if(ba.length==1){ba[0].innerHTML=bk.msg("show.folders",bc.folders)}bb.appendChild(bd)}else{if(bg&&bk._userCanUpload&&bk.dragAndDropEnabled){bm=C.get(bk.id+"-dnd-instructions-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bb.appendChild(bd)}else{if(bg&&bk._userCanUpload&&!bk.dragAndDropEnabled){bm=C.get(bk.id+"-upload-instructions-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bf(bd);bb.appendChild(bd)}}}}if(bg&&bk._userCanUpload&&bk.dragAndDropEnabled){bm=C.get(bk.id+"-other-options-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bb.appendChild(bd);if(bg&&bk._userCanUpload){if(bk.dragAndDropEnabled){bm=C.get(bk.id+"-standard-upload-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bf(bd);bb.appendChild(bd)}bm=C.get(bk.id+"-new-folder-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bf(bd);bb.appendChild(bd)}}}else{C.addClass(bb,"docListInstructions");if(bi){bm=C.get(bk.id+"-hidden-subfolders-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bf(bd);ba=C.getElementsByClassName("docListLinkedInstruction","a",bd);if(ba.length==1){ba[0].innerHTML=bk.msg("show.folders",bc.folders)}bb.appendChild(bd)}else{bm=C.get(bk.id+"-no-items-template");bd=bm.cloneNode(true);C.removeClass(bd,"hidden");bb.appendChild(bd)}}var bl=document.createElement("div");C.setStyle(bl,"clear","both");bb.appendChild(bl);this._setEmptyDataSourceMessage(bk,be.innerHTML)}};Alfresco.DocumentList=function(ba){Alfresco.DocumentList.superclass.constructor.call(this,"Alfresco.DocumentList",ba,["button","menu","container","datasource","datatable","paginator","json","history"]);this.currentPath="";this.currentPage=1;this.totalRecords=0;this.totalRecordsUpper=null;this.hideMoreActionsFn=null;this.state={actionEditOfflineActive:false};this.currentFilter={filterId:"path",filterData:""};this.actions={};this.selectedFiles={};this.afterDocListUpdate=[];this.doclistMetadata={};this.previewTooltips=[];this.insituEditors=[];this.dynamicControls=[];this.sortControls=[];this.dragAndDropAllowed=true;this.dragAndDropEnabled=false;this.dragEventRefCount=0;this.actionsView="browse";this.renderers={};this.viewRenderers={};this.dataSourceUrl=aP(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/doclist/");YAHOO.Bubbling.on("activateDynamicControls",this.onActivateDynamicControls,this);YAHOO.Bubbling.on("activateSortControls",this.onActivateSortControls,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("deactivateSortControls",this.onDeactivateSortControls,this);YAHOO.Bubbling.on("metadataRefresh",this.onDocListRefresh,this);YAHOO.Bubbling.on("fileRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("changeFilter",this.onChangeFilter,this);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("folderCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("nodeCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("folderRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("highlightFile",this.onHighlightFile,this);YAHOO.Bubbling.on("registerRenderer",this.onRegisterRenderer,this);YAHOO.Bubbling.on("registerViewRenderer",this.onRegisterViewRenderer,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("resizerChanged",this.onResizerChanged,this);YAHOO.Bubbling.on("fileCopied",this.onFileAction,this);YAHOO.Bubbling.on("fileDeleted",this.onFileAction,this);YAHOO.Bubbling.on("fileMoved",this.onFileAction,this);YAHOO.Bubbling.on("filePermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("folderCopied",this.onFileAction,this);YAHOO.Bubbling.on("folderDeleted",this.onFileAction,this);YAHOO.Bubbling.on("folderMoved",this.onFileAction,this);YAHOO.Bubbling.on("folderPermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("filesCopied",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesDeleted",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesMoved",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesPermissionsUpdated",this.onDocListRefresh,this);return this};YAHOO.extend(Alfresco.DocumentList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentList,Alfresco.doclib.Actions);Alfresco.DocumentList.generateFilterMarkup=function w(ba){var bb=Alfresco.util.cleanBubblingObject(ba);return YAHOO.lang.substitute("{filterOwner}|{filterId}|{filterData}|{filterDisplay}",bb,function(bd,be,bc){return typeof be==="undefined"?"":window.escape(be)})};Alfresco.DocumentList.generatePathMarkup=function aq(ba){return Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aP(ba.path,ba.file)})};Alfresco.DocumentList.generateCategoryMarkup=function m(ba){return Alfresco.DocumentList.generateFilterMarkup({filterId:"category",filterData:aP(ba[1],ba[0])})};Alfresco.DocumentList.generateFileFolderLinkMarkup=function i(bc,ba){var be=ba.jsNode,bb;if(be.isLink&&G(bc.options.siteId)&&ba.location.site&&ba.location.site.name!==bc.options.siteId){if(be.isContainer){bb=b("documentlibrary?path="+encodeURIComponent(ba.location.path),{site:ba.location.site.name})}else{bb=bc.getActionUrls(ba,ba.location.site.name).documentDetailsUrl}}else{if(be.isContainer){if(ba.parent.isContainer){bb='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(ba.location)}else{if(ba.location.path==="/"){bb='#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aP(ba.location.path,"")})}else{bb="#"}}}else{var bd=bc.getActionUrls(ba);if(be.isLink&&be.linkedNode.isContainer){bb=bd.folderDetailsUrl}else{bb=bd.documentDetailsUrl}}}return'<a href="'+bb+'">'};Alfresco.DocumentList.generateThumbnailUrl=function ah(ba,bd){var bc=ba.jsNode,bb=bc.isLink?bc.linkedNode.nodeRef:bc.nodeRef;if(bd==null){bd="doclib"}return Alfresco.constants.PROXY_URI+"api/node/"+bb.uri+"/content/thumbnails/"+bd+"?c=queue&ph=true"};Alfresco.DocumentList.generateFavourite=function aQ(bc,ba){var bd=ba.jsNode,be="favourite."+(bd.isContainer?"folder.":"document."),bb="";if(ba.isFavourite){bb='<a class="favourite-action enabled" title="'+bc.msg(be+"remove.tip")+'" tabindex="0"></a>'}else{bb='<a class="favourite-action" title="'+bc.msg(be+"add.tip")+'" tabindex="0">'+bc.msg(be+"add.label")+"</a>"}return bb};Alfresco.DocumentList.generateLikes=function r(bd,ba){var be=ba.node,bb=ba.likes,bf="like."+(be.isContainer?"folder.":"document."),bc="";if(bb.isLiked){bc='<a class="like-action enabled" title="'+bd.msg(bf+"remove.tip")+'" tabindex="0"></a>'}else{bc='<a class="like-action" title="'+bd.msg(bf+"add.tip")+'" tabindex="0">'+bd.msg(bf+"add.label")+"</a>"}bc+='<span class="likes-count">'+f(bb.totalLikes)+"</span>";return bc};Alfresco.DocumentList.generateComments=function aU(bd,ba){var bf=ba.node,be=bd.getActionUrls(ba),bb=be[bf.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",bg="comment."+(bf.isContainer?"folder.":"document.");var bc='<a href="'+bb+'" class="comment" title="'+bd.msg(bg+"tip")+'" tabindex="0">'+bd.msg(bg+"label")+"</a>";if(bf.properties["fm:commentCount"]!==undefined){bc+='<span class="comment-count">'+f(bf.properties["fm:commentCount"])+"</span>"}return bc};Alfresco.DocumentList.generateUserLink=function aZ(bb,ba){if(ba.isDeleted===true){return"<span>"+bb.msg("details.user.deleted",f(ba.userName))+"</span>"}return p(ba.userName,YAHOO.lang.trim(ba.firstName+" "+ba.lastName))};YAHOO.lang.augmentObject(Alfresco.DocumentList.prototype,{options:{sortAscending:true,showFolders:false,simpleView:null,viewRendererName:"detailed",viewRendererNames:["simple","detailed"],usePagination:false,siteId:"",containerId:"documentLibrary",rootNode:null,initialPage:1,pageSize:50,initialFilter:{},loadingMessageDelay:1000,highlightFile:null,previewTooltips:null,insituEditors:null,groupActivitiesAt:5,inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},replicationUrlMapping:{},listUpdated:false,repositoryBrowsing:true,useTitle:true,userIsSiteManager:false,actionsSplitAt:3},state:{actionEditOfflineActive:false},currentPath:null,currentPage:null,totalRecords:null,currentFilter:null,fileUpload:null,actions:null,selectedFiles:null,currentActionsMenu:null,hideMoreActionsFn:null,afterDocListUpdate:null,doclistMetadata:null,dynamicControls:null,sortControls:null,dragAndDropAllowed:null,dragAndDropEnabled:null,dragEventRefCount:null,dragFolderHighlight:null,renderers:null,viewRenderers:null,_userCanUpload:false,onReady:function Y(){var bm=this;this.dragAndDropEnabled=this.dragAndDropAllowed&&("draggable" in document.createElement("span"))&&YAHOO.env.ua.mobile===null;var bg=false;var bd=1;for(var bf=0,bp=this.options.viewRendererNames.length;bf<bp;bf++){if(this.options.viewRendererNames[bf]===this.options.viewRendererName){bg=true;bd=bf;break}}if(!bg){this.options.viewRendererName=this.options.viewRendererNames[1]}this._setupMetadataRenderers();this._setupHistoryManagers();this.widgets.sortAscending=Alfresco.util.createYUIButton(this,"sortAscending-button",this.onSortAscending);if(this.widgets.sortAscending!==null){this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(!this.options.sortAscending){C.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.sortControls.push(this.widgets.sortAscending)}this.widgets.sortField=Alfresco.util.createYUIButton(this,"sortField-button",this.onSortField,{type:"menu",menu:"sortField-menu",lazyloadmenu:false});if(this.widgets.sortField!==null){this.sortControls.push(this.widgets.sortField);var bb=this.widgets.sortField.getMenu().getItems(),bh;for(bh in bb){if(bb.hasOwnProperty(bh)){if(bb[bh].value===this.options.sortField){this.widgets.sortField.set("label",bb[bh].cfg.getProperty("text"));break}}}}this.widgets.showFolders=Alfresco.util.createYUIButton(this,"showFolders-button",this.onShowFolders,{type:"checkbox",checked:this.options.showFolders});if(this.widgets.showFolders!==null){this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.dynamicControls.push(this.widgets.showFolders)}this.widgets.viewRendererSelect=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.viewRendererSelect!==null){this.widgets.viewRendererSelect.check(bd);this.widgets.viewRendererSelect.on("checkedButtonChange",this.onViewRendererSelect,this.widgets.viewRendererSelect,this);this.dynamicControls.push(this.widgets.viewRendererSelect)}this.widgets.fileSelect=Alfresco.util.createYUIButton(this,"fileSelect-button",this.onFileSelect,{type:"menu",menu:"fileSelect-menu"});if(this.widgets.fileSelect!==null){this.dynamicControls.push(this.widgets.fileSelect)}this._setupViewRenderers();this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);this._setupDataSource();this._setupDataTable();var bo=function bc(bu,bt){var bq=YAHOO.Bubbling.getOwnerByTagName(bt[1].anchor,"div");if(bq!==null){if(typeof bm[bq.title]==="function"){bt[1].stop=true;var bs=bt[1].target;if(typeof bm.viewRenderers[bm.options.viewRendererName]==="object"){bs=bm.viewRenderers[bm.options.viewRendererName].getDataTableRecordIdFromRowElement(bm,bt[1].target)}var br=bm.widgets.dataTable.getRecord(bs).getData();bm[bq.title].call(bm,br,bq)}}return true};YAHOO.Bubbling.addDefaultAction("action-link",bo);YAHOO.Bubbling.addDefaultAction("show-more",bo);var bk=function bn(bs,br){var bq=YAHOO.Bubbling.getOwnerByTagName(br[1].anchor,"div");if(bq!==null){bm.onLikes.call(bm,br[1].target.offsetParent,bq)}return true};YAHOO.Bubbling.addDefaultAction("like-action",bk);var bj=function ba(bs,br){var bq=YAHOO.Bubbling.getOwnerByTagName(br[1].anchor,"div");if(bq!==null){bm.onFavourite.call(bm,br[1].target.offsetParent,bq)}return true};YAHOO.Bubbling.addDefaultAction("favourite-action",bj);var bl=function be(bs,br){var bq=br[1].anchor;if(bq!==null){var bt=bq.rel,bu,bv={};if(bt&&bt!==""){br[1].stop=true;bu=bt.split("|");bv={filterOwner:window.unescape(bu[0]||""),filterId:window.unescape(bu[1]||""),filterData:window.unescape(bu[2]||""),filterDisplay:window.unescape(bu[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",bv);YAHOO.Bubbling.fire("changeFilter",bv)}}return true};YAHOO.Bubbling.addDefaultAction("filter-change",bl);this.modules.actions=new Alfresco.module.DoclibActions();P.addListener(window,"resize",this._resizeRowContainers,this,true);YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(bi){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",bi);this.onHistoryManagerReady()}YAHOO.Bubbling.fire("postDocumentListOnReady",{scope:this,eventGroup:this.id})},_insituCallback:function au(bc,bb){var bf=bb.jsNode,be=bf.nodeRef;Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/documentlibrary/data/node/"+be.uri+"?filter="+encodeURIComponent(this.currentFilter.filterId)+"&view="+this.actionsView+"&noCache="+new Date().getTime(),successCallback:{fn:function ba(bg){bg.json.item.jsNode=new Alfresco.util.Node(bg.json.item.node);YAHOO.Bubbling.fire(bf.isContainer?"folderRenamed":"fileRenamed",{file:bg.json.item});return false},scope:this},failureCallback:{fn:function bd(bg){},scope:this}})},fnRenderCellSelected:function aH(){var ba=this;return function bb(bd,bc,be,bf){if(typeof ba.viewRenderers[ba.options.viewRendererName]==="object"){ba.viewRenderers[ba.options.viewRendererName].renderCellSelected(ba,bd,bc,be,bf)}}},fnRenderCellStatus:function R(){var ba=this;return function bb(bd,bc,be,bf){if(typeof ba.viewRenderers[ba.options.viewRendererName]==="object"){ba.viewRenderers[ba.options.viewRendererName].renderCellStatus(ba,bd,bc,be,bf)}}},fnRenderCellThumbnail:function a4(){var ba=this;return function bb(bd,bc,be,bf){if(typeof ba.viewRenderers[ba.options.viewRendererName]==="object"){ba.viewRenderers[ba.options.viewRendererName].renderCellThumbnail(ba,bd,bc,be,bf)}}},fnRenderCellDescription:function a1(){var ba=this;return function bb(bd,bc,be,bf){if(typeof ba.viewRenderers[ba.options.viewRendererName]==="object"){ba.viewRenderers[ba.options.viewRendererName].renderCellDescription(ba,bd,bc,be,bf)}}},fnRenderCellActions:function a5(){var bb=this;return function ba(bd,bc,be,bf){if(typeof bb.viewRenderers[bb.options.viewRendererName]==="object"){bb.viewRenderers[bb.options.viewRendererName].renderCellActions(bb,bd,bc,be,bf)}}},onRegisterRenderer:function T(bb,ba){var bc=ba[1];if(bc&&G(bc.propertyName)&&G(bc.renderer)){this.registerRenderer(bc.propertyName,bc.renderer)}else{Alfresco.logger.error("DL_onRegisterRenderer: Custom renderer registion invalid: "+bc)}},onRegisterViewRenderer:function o(bb,ba){var bc=ba[1];if(bc&&G(bc.renderer)){this.registerViewRenderer(bc.renderer)}else{Alfresco.logger.error("DL_onRegisterViewRenderer: Custom view renderer registion invalid: "+bc)}},registerRenderer:function aM(ba,bb){if(G(ba)&&G(bb)){this.renderers[ba]=bb;return true}return false},registerViewRenderer:function Q(ba){if(G(ba)){this.viewRenderers[ba.name]=ba;this.viewRenderers[ba.name].setupRenderer(this);return true}return false},_setupMetadataRenderers:function D(){this.registerRenderer("i18nLabel",function(ba,bb){return bb.replace(/:\s$/,"")});this.registerRenderer("lockBanner",function(ba,bc){var be=ba.jsNode.properties,bh=be.lockOwner||be.workingCopyOwner,bb=Alfresco.DocumentList.generateUserLink(this,bh),bg=ba.jsNode.isContainer,bf="details.banner.",bd="";if(bg){bf+="folder."}if(ba.workingCopy&&G(ba.workingCopy.googleDocUrl)){if(bh.userName===Alfresco.constants.USERNAME){bd=this.msg(bf+"google-docs-owner",'<a href="'+ba.workingCopy.googleDocUrl+'" target="_blank">'+this.msg("details.banner.google-docs.link")+"</a>")}else{bd=this.msg(bf+"google-docs-locked",bb,'<a href="'+ba.workingCopy.googleDocUrl+'" target="_blank">'+this.msg("details.banner.google-docs.link")+"</a>")}}else{if(ba.workingCopy&&bh.userName===Alfresco.constants.USERNAME){bd=this.msg(bf+(ba.workingCopy.isWorkingCopy?"editing":"lock-owner"))}else{bd=this.msg(bf+"locked",bb)}}return bd});this.registerRenderer("syncFailed",function(ba,bb){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-failed")});this.registerRenderer("syncTransientError",function(ba,bb){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-transient-error")});this.registerRenderer("date",function(ba,bb){var bf=ba.jsNode,bd=bf.properties,bc="";var be="modified",bg=bd.modified.iso8601;if(ba.workingCopy&&ba.workingCopy.isWorkingCopy){be="editing-started"}else{if(bg===bd.created.iso8601){be="created"}}bc='<span class="item">'+bb+this.msg("details."+be+"-by",af(bg),Alfresco.DocumentList.generateUserLink(this,bd.modifier))+"</span>";return bc});this.registerRenderer("size",function(ba,bb){var be=ba.jsNode,bd=be.properties,bc="";if(!be.isContainer&&!be.isLink){bc+='<span class="item">'+bb+Alfresco.util.formatFileSize(be.size)+"</span>"}return bc});this.registerRenderer("description",function(ba,bb){var be=ba.jsNode,bd=be.properties,bf=Alfresco.util.generateDomId(),bc='<span id="'+bf+'" class="faded">'+bb+this.msg("details.description.none")+"</span>";if(bd.description&&bd.description!==""){bc='<span id="'+bf+'" class="item">'+bb+ao(f(bd.description))+"</span>"}return bc});this.registerRenderer("tags",function(bf,bh){var bb=bf.jsNode,bg=bb.properties,ba=Alfresco.util.generateDomId(),be="";var bi=bb.tags,bj;if(bb.hasAspect("cm:taggable")&&bi.length>0){for(var bd=0,bc=bi.length;bd<bc;bd++){bj=f(bi[bd]);be+='<span class="tag"><a href="#" class="tag-link" rel="'+bj+'">'+bj+"</a></span>"}}else{be+='<span class="faded">'+bh+this.msg("details.tags.none")+"</span>"}if(bb.hasPermission("Write")&&!bb.isLocked){this.insituEditors.push({context:ba,params:{type:"tagEditor",nodeRef:bb.nodeRef.toString(),name:"prop_cm_taggable",value:bf.node.properties["cm:taggable"],validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")}],title:this.msg("tip.insitu-tag"),errorMessage:this.msg("message.insitu-edit.tag.failure")},callback:{fn:this._insituCallback,scope:this,obj:bf}})}return'<span id="'+ba+'" class="item">'+bh+be+"</span>"});this.registerRenderer("categories",function(bg,bi){var ba=bg.jsNode,bh=ba.properties,be="";if(ba.hasAspect("cm:generalclassifiable")){var bf=ba.categories,bb;be+='<span class="category-item item">&nbsp;</span><span class="item">'+bi;if(bf.length>0){for(var bd=0,bc=bf.length;bd<bc;bd++){bb=bf[bd];be+='<span class="category"><a href="#" class="filter-change" rel="'+Alfresco.DocumentList.generateCategoryMarkup(bb)+'">'+f(bb[0])+"</a></span>"+(bc-bd>1?", ":"")}}else{be+='<span class="faded">'+bi+this.msg("details.categories.none")+"</span>"}be+="</span>"}return be});this.registerRenderer("social",function(ba){var bd=ba.jsNode,bc=bd.properties,bb="";bb+='<span class="item item-social">'+Alfresco.DocumentList.generateFavourite(this,ba)+"</span>";bb+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateLikes(this,ba)+"</span>";if(bd.permissions.user.CreateChildren){bb+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateComments(this,ba)+"</span>"}return bb})},_setupViewRenderers:function X(){var bb=new Alfresco.DocumentListViewRenderer("simple");bb.actionsColumnWidth=80;bb.actionsSplitAtModifier=0;bb.renderCellThumbnail=function ba(br,bq,bs,bm,bi){var bl=bs.getData(),bj=bl.jsNode,bo=bj.properties,be=bl.displayName,bh=bj.isContainer,bk=bj.isLink,bn=be.substring(be.lastIndexOf(".")),bd=bj.nodeRef.nodeRef;var bp;bm.width=40;C.setStyle(bq,"width",bm.width+"px");C.setStyle(bq.parentNode,"width",bm.width+"px");if(bh){bq.innerHTML='<span class="folder-small">'+(bk?'<span class="link"></span>':"")+(br.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(br,bl)+'<img id="'+bd+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-32.png" /></a>';bp=new YAHOO.util.DDTarget(bd)}else{var bg=br.id+"-preview-"+bs.getId();bq.innerHTML='<span id="'+bg+'" class="icon32">'+(bk?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(br,bl)+'<img id="'+bd+'" src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(be)+'" alt="'+bn+'" title="'+f(be)+'" /></a></span>';br.previewTooltips.push(bg)}var bf=new Alfresco.DnD(bd,br)};bb.setupRenderer=function bc(bd){C.addClass(bd.id+this.buttonElementIdSuffix,this.buttonCssClass);bd.widgets.previewTooltip=new YAHOO.widget.Tooltip(bd.id+"-previewTooltip",{width:"108px"});bd.widgets.previewTooltip.contextTriggerEvent.subscribe(function(bh,bf){var bg=bf[0],bi=bd.widgets.dataTable.getRecord(bg.id),be=bi.getData();this.cfg.setProperty("text",'<img src="'+Alfresco.DocumentList.generateThumbnailUrl(be)+'" />')})};this.registerViewRenderer(bb);this.registerViewRenderer(new Alfresco.DocumentListViewRenderer("detailed"));YAHOO.Bubbling.fire("postSetupViewRenderers",{scope:this,eventGroup:this.id})},_setupHistoryManagers:function aD(){var bd=YAHOO.util.History.getBookmarkedState("filter");bd=bd||"path|/";try{while(bd!==(bd=decodeURIComponent(bd))){}}catch(bg){}var bb=function bi(bj){var bk=bj.split("|"),bl={filterId:window.unescape(bk[0]||"")};if(typeof bk[1]!=="undefined"){bl.filterData=window.unescape(bk[1])}if(typeof bk[2]!=="undefined"){bl.filterDisplay=window.unescape(bk[2])}bl.filterOwner=Alfresco.util.FilterManager.getOwner(bl.filterId);return bl};this.options.initialFilter=bb(bd);YAHOO.util.History.register("filter",bd,function ba(bj){Alfresco.logger.debug("HistoryManager: filter changed:"+bj);if(YAHOO.env.ua.gecko>0){bj=window.unescape(bj);Alfresco.logger.debug("HistoryManager: filter (after Firefox fix):"+bj)}this._updateDocList.call(this,{filter:bb(bj),page:this.currentPage})},null,this);var bc=function be(bk,bj){bj.widgets.paginator.setState(bk);YAHOO.util.History.navigate("page",String(bk.page))};if(this.options.usePagination){var bh=YAHOO.util.History.getBookmarkedState("page")||"1";while(bh!==(bh=decodeURIComponent(bh))){}this.currentPage=parseInt(bh||this.options.initialPage,10);YAHOO.util.History.register("page",bh,function bf(bj){Alfresco.logger.debug("HistoryManager: page changed:"+bj);if(this.currentPage!=bj){this._updateDocList.call(this,{page:bj})}else{Alfresco.logger.debug("...page changed event ignored.")}},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",bc,this);C.setStyle(this.id+"-doclistBarBottom","display","block")}},_setupDataSource:function ag(){var bb=this;this.widgets.dataSource=new YAHOO.util.DataSource(this.dataSourceUrl,{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords",totalRecordsUpper:"totalRecordsUpper"}}});this.widgets.dataSource.doBeforeCallback=function ba(be,bc,bf){bb.doclistMetadata=bc.metadata;YAHOO.Bubbling.fire("doclistMetadata",{metadata:bb.doclistMetadata});var bd=null;if(bb.doclistMetadata.parent){bd=bb.doclistMetadata.parent.permissions;if(bd&&bd.user){YAHOO.Bubbling.fire("userAccess",{userAccess:bd.user})}}if(typeof bb.viewRenderers[bb.options.viewRendererName]==="object"){bb.viewRenderers[bb.options.viewRendererName].renderEmptyDataSourceHtml(bb,bd)}return bf}},_setupDataTable:function a2(){var bi=this;var bb=C.get("alf-filters"),bc=(bb?parseInt(bb.style.width,10):160)+390;var bd=[{key:"nodeRef",label:"Select",sortable:false,formatter:this.fnRenderCellSelected(),width:16},{key:"status",label:"Status",sortable:false,formatter:this.fnRenderCellStatus(),width:16},{key:"thumbnail",label:"Preview",sortable:false,formatter:this.fnRenderCellThumbnail(),width:100},{key:"fileName",label:"Description",sortable:false,formatter:this.fnRenderCellDescription(),width:(C.getViewportWidth()-bc)},{key:"actions",label:"Actions",sortable:false,formatter:this.fnRenderCellActions(),width:200}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-documents",bd,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,dynamicData:true,MSG_EMPTY:this.msg("message.loading")});this.widgets.dataTable.handleDataReturnPayload=function bf(bk,bj,bl){bi.totalRecords=bj.meta.totalRecords;bi.totalRecordsUpper=bj.meta.totalRecordsUpper;return bj.meta};this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.subscribe("tableMsgShowEvent",function(bo){this._elMsgTbody.parentNode.style.width="";if(bo.html&&bo.html.indexOf("docListInstructions")!==-1){var br=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(br!==null){var bp=C.get(bi.id+"-standard-upload-link-template-instance");if(bp!==null){var bs=C.getChildren(bp);P.addListener(bs[0],"click",br.onFileUpload,br,true);P.addListener(C.getFirstChild(bs[1]),"click",br.onFileUpload,br,true)}var bn=C.get(bi.id+"-new-folder-link-template-instance");if(bn!==null){var bq=C.getChildren(bn);P.addListener(bq[0],"click",br.onNewFolder,br,true);P.addListener(C.getFirstChild(bq[1]),"click",br.onNewFolder,br,true)}}var bj=C.get(bi.id+"-show-folders-template-instance");if(bj!==null){var bl=function bk(){this.widgets.showFolders.set("checked",true)};var bm=C.getChildren(bj);P.addListener(bm[0],"click",bl,bi,true);P.addListener(bm[1],"click",bl,bi,true)}}});this.widgets.dataTable.doBeforeLoadData=function ba(bl,bn,bp){if(bn.error){try{var bj=YAHOO.lang.JSON.parse(bn.responseText);bi.widgets.dataTable.set("MSG_ERROR",bj.message)}catch(bo){bi._setDefaultDataTableErrors(bi.widgets.dataTable)}}else{if(bn.results.length===0){this.fireEvent("renderEvent",{type:"renderEvent"})}else{for(var bk=0,bm=bn.results.length;bk<bm;bk++){bn.results[bk].jsNode=new Alfresco.util.Node(bn.results[bk].node)}}}return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function bg(bj){var bk=bj.target.value;this.selectedFiles[bk]=bj.target.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function bh(){Alfresco.logger.debug("DataTable renderEvent");if(0<YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){var bk=this.widgets.dataTable.getTableEl().parentNode;bk.className=bk.className}if(this.widgets.paginator){Alfresco.logger.debug("Setting paginator state: page="+this.currentPage+", totalRecords="+this.totalRecords);this.widgets.paginator.setState({page:this.currentPage,totalRecords:this.totalRecords});if(this.totalRecordsUpper){this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report.more"))}else{this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report"))}this.widgets.paginator.render()}if(this.options.highlightFile){YAHOO.Bubbling.fire("highlightFile",{fileName:window.unescape(this.options.highlightFile)})}else{if(this.listUpdated){var bo=C.getY(this.id+"-documents"),bj=YAHOO.env.ua.ie>0?((document.compatMode&&document.compatMode!=="BackCompat")?document.documentElement:document.body).scrollTop:window.scrollY;if(bj>bo){window.scrollTo(0,bo)}}}var bn,bm;for(bn=0,bm=this.afterDocListUpdate.length;bn<bm;bn++){this.afterDocListUpdate[bn].call(this)}this.afterDocListUpdate=[];this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips);var bl;for(bn=0,bm=this.insituEditors.length;bn<bm;bn++){bl=this.insituEditors[bn];Alfresco.util.createInsituEditor(bl.context,bl.params,bl.callback)}this.widgets.dataTable.set("renderLoopSize",this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE)},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);P.delegate(this.id,"click",function be(bk,bm){var bl=bm.getAttribute("data-action"),bj=bi.widgets.dataTable.getRecord(bm).getData();if(YAHOO.lang.isFunction(bi[bl])){bi[bl].call(bi,bj,bm)}else{if(YAHOO.lang.isFunction(window[bl])){window[bl](bj,bm)}}},"a.indicator-action");if(this.dragAndDropEnabled){P.addListener(document.body,"dragenter",this._swallowDragEnter,this,true);P.addListener(document.body,"dragover",this._swallowDragOver,this,true);P.addListener(document.body,"drop",this._swallowDragDrop,this,true);P.addListener(document.body,"dragstart",this._swallowDragStart,this,true)}},_removeDragAndDrop:function az(){if(this.dragAndDropEnabled){try{var bb=C.get(this.id+"-body");P.removeListener(bb,"dragenter");P.removeListener(bb,"dragover");P.removeListener(bb,"dragleave");P.removeListener(bb,"drop")}catch(ba){Alfresco.logger.error("_removeDragAndDrop: The following exception occurred: ",ba)}}},_addDragAndDrop:function I(){if(this._userCanUpload&&this.dragAndDropEnabled){try{var bb=C.get(this.id+"-body");P.addListener(bb,"dragenter",this.onDocumentListDragEnter,this,true);P.addListener(bb,"dragover",this.onDocumentListDragOver,this,true);P.addListener(bb,"dragleave",this.onDocumentListDragLeave,this,true);P.addListener(bb,"drop",this.onDocumentListDrop,this,true)}catch(ba){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",ba)}}},_swallowDragStart:function s(ba){ba.stopPropagation();ba.preventDefault()},_swallowDragEnter:function t(ba){ba.stopPropagation();ba.preventDefault()},_swallowDragOver:function ai(ba){ba.dataTransfer.dropEffect="none";ba.stopPropagation();ba.preventDefault()},_swallowDrop:function aF(ba){ba.stopPropagation();ba.preventDefault()},onDocumentListDragEnter:function at(bf){var bb=bf.target,bd=this.widgets.dataTable.getRecord(bb),ba=this.widgets.dataTable.getColumn(bb),be=this.widgets.dataTable.getContainerEl(),bc;if(bd&&ba&&(bb.tagName=="IMG"||bb.className=="droppable")&&ba.getKey()=="thumbnail"){bc=bd.getData("jsNode");if(bc&&bc.isContainer){this.dragFolderHighlight=C.getAncestorByClassName(bb,"folder");C.addClass(this.dragFolderHighlight,"dndFolderHighlight");C.removeClass(be,"dndDocListHighlight")}}else{this.dragEventRefCount=Math.min(++this.dragEventRefCount,2);C.addClass(be,"dndDocListHighlight");if(this.dragFolderHighlight){C.removeClass(this.dragFolderHighlight,"dndFolderHighlight");this.dragFolderHighlight=null}}bf.stopPropagation();bf.preventDefault()},onDocumentListDragOver:function l(ba){ba.dataTransfer.dropEffect=Math.floor(YAHOO.env.ua.gecko)===1?"move":"copy";ba.stopPropagation();ba.preventDefault()},onDocumentListDragLeave:function a7(be){var bb=be.target,bc=this.widgets.dataTable.getRecord(bb),bd=this.widgets.dataTable.getColumn(bb),ba=bc?bc.getData():null;if(bc&&bd&&(bb.tagName=="IMG"||bb.className=="droppable")&&ba.node.isContainer&&bd.getKey()=="thumbnail"){}else{if(--this.dragEventRefCount===0){C.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight")}}be.stopPropagation();be.preventDefault()},onDocumentListDrop:function ak(bk){try{if(bk.dataTransfer.files!==undefined&&bk.dataTransfer.files!==null&&bk.dataTransfer.files.length>0){var bh=Alfresco.getDNDUploadProgressInstance();var bb=false;var bl="",be,bd;bd=bk.dataTransfer.files.length;for(be=0;be<bd;be++){if(bk.dataTransfer.files[be].size>0){bb=true}else{bl+='"'+bk.dataTransfer.files[be].fileName+'", '}}if(!bb){bl=bl.substring(0,bl.lastIndexOf(", "));Alfresco.util.PopupManager.displayMessage({text:bh.msg("message.zeroByteFiles",bl)})}if(bb&&bh.uploadMethod===bh.INMEMORY_UPLOAD){var bo=0;bd=bk.dataTransfer.files.length;for(be=0;be<bd;be++){bo+=bk.dataTransfer.files[be].size}if(bo>bh.getInMemoryLimit()){bb=false;Alfresco.util.PopupManager.displayPrompt({text:bh.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(bh.getInMemoryLimit()))})}}if(bb){var bj=this.currentPath,ba=bj.substring(bj.lastIndexOf("/")+1),bm=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null;var bp=this.widgets.dataTable.getRecord(bk.target);if(bp!==null){var bi=this.widgets.dataTable.getColumn(bk.target),bg=bp.getData();if(bp&&bi&&bk.target.tagName=="IMG"&&bg.node.isContainer&&bi.getKey()=="thumbnail"){var bn=bg.location;ba=bn.file;bj=aP(bn.path,bn.file);bm=bg.nodeRef}}C.removeClass(this.widgets.dataTable.getTrEl(bk.target),"dndFolderHighlight");C.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var bf={files:bk.dataTransfer.files,uploadDirectoryName:ba,filter:[],mode:bh.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};if(G(this.options.siteId)){bf.siteId=this.options.siteId;bf.containerId=this.options.containerId;bf.uploadDirectory=bj}else{bf.destination=bm}bh.show(bf)}}else{Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",bk.dataTransfer)}}catch(bc){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",bc)}bk.stopPropagation();bk.preventDefault()},onHistoryManagerReady:function B(){if(this.options.initialFilter.filterId==="path"&&window.location.hash=="#upload"){window.location.hash="";var ba=function bb(){YAHOO.Bubbling.fire("showFileUploadDialog",{tooltip:this.msg("dnd.upload.tooltip")})};this.afterDocListUpdate.push(ba)}Alfresco.logger.debug("DL_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);YAHOO.Bubbling.fire("changeFilter",YAHOO.lang.merge({doclistFirstTimeNav:true},this.options.initialFilter));C.setStyle(this.id+"-body","visibility","visible")},getSelectedFiles:function a9(){var be=[],bf=this.widgets.dataTable.getRecordSet(),bd,bc,bb,ba;for(bb=0,ba=bf.getLength();bb<ba;bb++){bd=bf.getRecord(bb);bc=bd.getData("node");if(this.selectedFiles[bc.nodeRef]){be.push(bd.getData())}}return be},selectFiles:function A(bl){var bm;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){bm=C.get(this.id+this.viewRenderers[this.options.viewRendererName].parentElementIdSuffix)}var bh=this.widgets.dataTable.getRecordSet(),bc=YAHOO.util.Selector.query('input[type="checkbox"]',bm),bg=bc.length,bn,be,bd,bk;switch(bl){case"selectAll":bk=function bi(bo,bp){return true};break;case"selectNone":bk=function bf(bo,bp){return false};break;case"selectInvert":bk=function bb(bo,bp){return !bp};break;case"selectDocuments":bk=function ba(bo,bp){return !(bo.node.isContainer)};break;case"selectFolders":bk=function ba(bo,bp){return bo.node.isContainer};break;default:bk=function bj(bo,bp){return bp}}for(bd=0;bd<bg;bd++){bn=bh.getRecord(bd);be=bn.getData();this.selectedFiles[be.nodeRef]=bc[bd].checked=bk(be,bc[bd].checked)}YAHOO.Bubbling.fire("selectedFilesChanged")},onSortAscending:function aa(ba,bb){this.options.sortAscending=!this.options.sortAscending;this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(this.options.sortAscending){C.removeClass(this.widgets.sortAscending.get("element"),"sort-descending")}else{C.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.services.preferences.set(aK,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh");if(ba){P.preventDefault(ba)}},onSortField:function aY(bf,be,bd){var ba=be[0],bc=be[1];if(bc){var bb=this;this.options.sortField=bc.value;this.widgets.sortField.set("label",bc.cfg.getProperty("text"));this.services.preferences.set(d,this.options.sortField,{successCallback:{fn:function(){var bg=bc.srcElement.getAttribute("title");if(bg==="true"||bg==="false"){bb.options.sortAscending=(bg==="false");bb.onSortAscending()}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})}P.preventDefault(ba)},onShowFolders:function k(ba,bb){this.options.showFolders=this.widgets.showFolders.get("checked");this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.services.preferences.set(ab,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh");if(ba){P.preventDefault(ba)}},onViewRendererSelect:function a8(ba,bb){this.options.viewRendererName=this.options.viewRendererNames[ba.newValue.index];this.services.preferences.set(ad,this.options.viewRendererName);YAHOO.Bubbling.fire("metadataRefresh");if(ba){P.preventDefault(ba)}},onFileSelect:function c(be,bd,bc){var ba=bd[0],bb=bd[1];this.selectFiles(Alfresco.util.findEventClass(bb));P.preventDefault(ba)},onEventHighlightRow:function ae(ba){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventHighlightRow(this,ba)}},onEventUnhighlightRow:function K(ba){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventUnhighlightRow(this,ba)}},onActionShowMore:function F(bb,ba){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onActionShowMore(this,bb,ba)}},onActionEditOffline:function V(bc){if(!this.state.actionEditOfflineActive){this.state.actionEditOfflineActive=true;var bd=bc.jsNode.nodeRef,bb=bc.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function be(bh){this.state.actionEditOfflineActive=false;this.options.highlightFile=bb;var bg=function bf(){var bk=Alfresco.constants.PROXY_URI+bh.json.results[0].downloadUrl;if(YAHOO.env.ua.ie>6){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-offline.success",bb),text:this.msg("message.edit-offline.success.ie7"),buttons:[{text:this.msg("button.download"),handler:function bj(){window.location=bk;this.destroy()},isDefault:true},{text:this.msg("button.close"),handler:function bi(){this.destroy()}}]})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-offline.success",bb)});YAHOO.lang.later(3000,this,function(){window.location=bk})}};this.afterDocListUpdate.push(bg)},scope:this}},failure:{callback:{fn:function ba(){this.state.actionEditOfflineActive=false},scope:this},message:this.msg("message.edit-offline.failure",bb)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:bd.uri}}})}},onActionCheckoutToGoogleDocs:function aX(bc){var bb=bc.displayName,be=bc.jsNode.nodeRef,bf=bc.location.path,bh=bc.fileName;var bg=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkout-google.inprogress",bb)});this.modules.actions.genericAction({success:{event:{name:"changeFilter",obj:{filterId:"editingMe"}},callback:{fn:function ba(bk){bg.destroy();this.options.highlightFile=bb;var bi=function bj(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.success",bb)})};this.afterDocListUpdate.push(bi)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkout",page:"document-details",activityData:{fileName:bh,path:bf,nodeRef:be.toString()}}},failure:{callback:{fn:function bd(bi){bg.destroy();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.failure",bb)})},scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:be.uri}}})},onActionCheckinFromGoogleDocs:function n(bc){var bb=bc.displayName,bd=bc.jsNode.nodeRef,ba=new Alfresco.util.NodeRef(bc.workingCopy.sourceNodeRef),be=bc.location.path;var bg=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkin-google.inprogress",bb)});this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function bf(bj){bg.destroy();var bh=function bi(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkin-google.success",bb)})};this.afterDocListUpdate.push(bh)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkin",page:"document-details",activityData:{fileName:bb,path:be,nodeRef:ba.toString()}}},failure:{message:this.msg("message.checkin-google.failure",bb)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkin/node/{nodeRef}",params:{nodeRef:bd.uri}}})},onFileAction:function aJ(bb,ba){var bc=ba[1];if(bc){if(!bc.multiple){this._updateDocList.call(this)}}},onFileRenamed:function M(bb,ba){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onFileRenamed(this,bb,ba)}},onDocListRefresh:function aj(bb,ba){var bc=ba[1];if(bc&&(bc.highlightFile!==null)){this.options.highlightFile=bc.highlightFile}this._updateDocList.call(this)},onChangeFilter:function J(bc,bb){var bf=bb[1];if((bf!==null)&&(bf.filterId!==null)){var be=Alfresco.util.cleanBubblingObject(bf),bd=window.escape(bf.filterId)+(typeof bf.filterData!=="undefined"?"|"+window.escape(bf.filterData)+(typeof bf.filterDisplay!=="undefined"?"|"+window.escape(bf.filterDisplay):""):"");Alfresco.logger.debug("DL_onChangeFilter: ",be);this._removeDragAndDrop();if(bf.filterId==="path"){this._addDragAndDrop()}this.listUpdated=true;var ba={filter:bd};if(bf.doclistFirstTimeNav){this._updateDocList.call(this,{filter:be,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;ba.page="1"}Alfresco.logger.debug("DL_onChangeFilter: objNav = ",ba);if(this.options.highlightFile&&ba.filter===YAHOO.util.History.getCurrentState("filter")){YAHOO.Bubbling.fire("highlightFile",{fileName:this.options.highlightFile})}YAHOO.util.History.multiNavigate(ba)}}},onFilterChanged:function x(bb,ba){var bc=ba[1];if((bc!==null)&&(bc.filterId!==null)){bc.filterOwner=bc.filterOwner||Alfresco.util.FilterManager.getOwner(bc.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(bc);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onHighlightFile:function al(bb,ba){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onHighlightFile(this,bb,ba)}},onDeactivateAllControls:function Z(bc,bb){var ba,bd=Alfresco.util.disableYUIButton;for(ba in this.widgets){if(this.widgets.hasOwnProperty(ba)){bd(this.widgets[ba])}}},onDeactivateDynamicControls:function ay(bc,bb){var ba,bd=Alfresco.util.disableYUIButton;for(ba in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(ba)){bd(this.dynamicControls[ba])}}},onDeactivateSortControls:function aL(bc,bb){var ba,bd=Alfresco.util.disableYUIButton;for(ba in this.sortControls){if(this.sortControls.hasOwnProperty(ba)){bd(this.sortControls[ba])}}},onActivateSortControls:function g(bc,bb){var ba,bd=Alfresco.util.enableYUIButton;for(ba in this.sortControls){if(this.sortControls.hasOwnProperty(ba)){bd(this.sortControls[ba])}}},onActivateDynamicControls:function H(bc,bb){var ba,bd=Alfresco.util.enableYUIButton;for(ba in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(ba)){bd(this.dynamicControls[ba])}}},onLikes:function E(bg){var bd=bg;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){bd=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,bg)}var bh=this.widgets.dataTable.getRecord(bd),be=bh.getData(),bf=be.jsNode.nodeRef,bb=be.likes;bb.isLiked=!bb.isLiked;bb.totalLikes+=(bb.isLiked?1:-1);var bi={successCallback:{fn:function ba(bp,bm){var bq=bp.json.data;if(bq){var bo=this._findRecordByParameter(bm,"nodeRef"),bj=bo.getData(),bn=bj.node,bk=bj.likes;bk.totalLikes=bq.ratingsCount;this.widgets.dataTable.updateRow(bo,bj);if(bk.isLiked){var bl={fileName:bj.fileName,nodeRef:bn.nodeRef};if(bn.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",bl)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",bl)}}}},scope:this,obj:bf.toString()},failureCallback:{fn:function bc(bn,bl){var bm=this._findRecordByParameter(bl,"nodeRef"),bj=bm.getData(),bk=bj.likes;bk.isLiked=!bk.isLiked;bk.totalLikes+=(bk.isLiked?1:-1);this.widgets.dataTable.updateRow(bm,bj);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bj.displayName)})},scope:this,obj:bf.toString()}};if(bb.isLiked){this.services.likes.set(bf,1,bi)}else{this.services.likes.remove(bf,bi)}this.widgets.dataTable.updateRow(bh,be)},onFavourite:function aG(bh){var be=bh;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){be=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,bh)}var bi=this.widgets.dataTable.getRecord(be),bf=bi.getData(),bd=bf.node,bg=bd.nodeRef;bf.isFavourite=!bf.isFavourite;this.widgets.dataTable.updateRow(bi,bf);var bj={failureCallback:{fn:function ba(bo,bk){var bn=this.widgets.dataTable.getRecord(bk),bl=bn.getData(),bm=bl.node;bl.isFavourite=!bl.isFavourite;this.widgets.dataTable.updateRow(bn,bl);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bl.displayName)})},scope:this,obj:bh}};var bb=bf.isFavourite?"add":"remove",bc=bd.isContainer?Alfresco.service.Preferences.FAVOURITE_FOLDERS:Alfresco.service.Preferences.FAVOURITE_DOCUMENTS;this.services.preferences[bb].call(this.services.preferences,bc,bg,bj)},onResizerChanged:function aW(){this._resizeRowContainers()},_resizeRowContainers:function ar(){var ba=C.get("alf-filters"),be=(ba?parseInt(ba.style.width,10):160)+390,bd=(C.getViewportWidth()-be)+"px",bb=YAHOO.util.Selector.query("h3.filename",this.id+"-documents");for(var bc=0;bc<bb.length;bc++){bb[bc].parentNode.style.width=bd}},_setDefaultDataTableErrors:function e(ba){var bb=Alfresco.util.message;ba.set("MSG_EMPTY",bb("message.empty","Alfresco.DocumentList"));ba.set("MSG_ERROR",bb("message.error","Alfresco.DocumentList"))},_updateDocList:function aO(bn){bn=bn||{};Alfresco.logger.debug("DL__updateDocList: ",bn.filter,bn.page);var bp=YAHOO.lang.merge({doclistFirstTimeNav:false},bn.filter!==undefined?bn.filter:this.currentFilter),bb=bn.page!==undefined?bn.page:this.currentPage,bj=null,bf=null,bl=this,bd={filter:bp,page:bb};var bg=function bk(){Alfresco.logger.debug("DL__uDL_fnShowLoadingMessage: slow data webscript detected.");if(bf){bj=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+f(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{bj.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.previewTooltips=[];this.insituEditors=[];this.hideMoreActionsFn=null;this.loadingMessageShowing=false;bf=YAHOO.lang.later(this.options.loadingMessageDelay,this,bg);var bo=function bh(){if(bf){bf.cancel();bf=null}if(bj){if(this.loadingMessageShowing){bj.destroy();bj=null}else{YAHOO.lang.later(100,bl,bo)}}};var bi=function bc(bt,bv,bw){bo();var bq=function br(){YAHOO.Bubbling.fire("activateDynamicControls");YAHOO.Bubbling.fire("selectedFilesChanged");this.listUpdated=false;if(this.currentFilter.filterId=="recentlyModified"||this.currentFilter.filterId=="recentlyAdded"){YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("activateSortControls")}};this.afterDocListUpdate.push(bq);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",bp);Alfresco.logger.debug("currentPage was ["+this.currentPage+"] now ["+bb+"]");this.currentFilter=bp;this.currentPage=bb;if(bp.filterId==="path"){Alfresco.logger.debug("currentPath was ["+this.currentPath+"] now ["+bp.filterData+"]");this.currentPath=bp.filterData}delete bp.doclistFirstTimeNav;YAHOO.Bubbling.fire("filterChanged",bp);for(var bs=0,bu=this.options.viewRendererNames.length;bs<bu;bs++){this.viewRenderers[this.options.viewRendererNames[bs]].destroyView(this,bt,bv,bw)}this.viewRenderers[this.options.viewRendererName].renderView(this,bt,bv,bw)};var ba=function be(bq,br){bo();this.afterDocListUpdate=[];if(br.status===401){window.location.reload(true)}else{try{if(br.status===404){YAHOO.Bubbling.fire("deactivateDynamicControls");YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("deactivateAllControls")}var bu=function bs(bx,bw){return function bv(){this.widgets.paginator.setState({totalRecords:0});this.widgets.paginator.render();this.widgets.dataTable.set("MSG_ERROR",bx);if(bw===410){this.widgets.dataTable.showTableMessage(bx,YAHOO.widget.DataTable.CLASS_DISABLED)}else{this.widgets.dataTable.showTableMessage(bx,YAHOO.widget.DataTable.CLASS_ERROR)}}};this.afterDocListUpdate.push(bu(YAHOO.lang.JSON.parse(br.responseText).message,br.status));this.widgets.dataTable.initializeTable();this.widgets.dataTable.render();this.listUpdated=false}catch(bt){Alfresco.logger.error(bt);this._setDefaultDataTableErrors(this.widgets.dataTable)}}};if(bd.filter&&bd.filter.filterId==="path"){bd.path=bd.filter.filterData}var bm=this._buildDocListParams(bd);Alfresco.logger.debug("DataSource requestParams: ",bm);this.widgets.dataSource.sendRequest(bm,{success:bi,failure:ba,scope:this})},_buildDocListParams:function a(be){var bb=G(this.options.siteId),bc={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};if(this.options.usePagination){bc.page=this.widgets.paginator.getCurrentPage()||this.currentPage;bc.pageSize=this.widgets.paginator.getRowsPerPage()}if(typeof be==="object"){bc=YAHOO.lang.merge(bc,be)}var ba=bb?"site/{site}/{container}":"node/alfresco/company/home",bd=YAHOO.lang.substitute("{type}/"+ba+(bc.filter.filterId==="path"?"{path}":""),{type:encodeURIComponent(bc.type),site:encodeURIComponent(bc.site),container:encodeURIComponent(bc.container),path:aP("/",Alfresco.util.encodeURIPath(bc.path).replace(/%25/g,"%2525"))});bd+="?filter="+encodeURIComponent(bc.filter.filterId);if(bc.filter.filterData&&bc.filter.filterId!=="path"){bd+="&filterData="+encodeURIComponent(bc.filter.filterData)}if(this.options.usePagination){bd+="&size="+bc.pageSize+"&pos="+bc.page}bd+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField);if(!bb){bd+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}bd+="&view="+this.actionsView+"&noCache="+new Date().getTime();return bd},_findRecordByParameter:function aR(bg,bf){var be=this.widgets.dataTable.getRecordSet(),bd,ba,bc,bb;for(bc=0,bb=be.getLength();bc<bb;bc++){bd=be.getRecord(bc);ba=bd.getData();if(ba[bf]===bg||(ba.node&&ba.node[bf]===bg)){return bd}}return null}},true)})();