(function(){var c=YAHOO.util.Dom,h=YAHOO.util.Event;Alfresco.CollaborationTitle=function(k){Alfresco.CollaborationTitle.superclass.constructor.call(this,"Alfresco.CollaborationTitle",k);this.preferencesService=new Alfresco.service.Preferences();return this};YAHOO.extend(Alfresco.CollaborationTitle,Alfresco.component.Base,{options:{user:null,site:null,siteTitle:null},onReady:function d(){h.on(c.get(this.id+"-join-link"),"click",function(k){this.joinSite();h.stopEvent(k)},this,true);h.on(c.get(this.id+"-requestJoin-link"),"click",function(k){this.requestJoinSite();h.stopEvent(k)},this,true);h.on(c.get(this.id+"-become-manager-link"),"click",function(k){this.becomeSiteManager();h.stopEvent(k)},this,true);this.widgets.more=new YAHOO.widget.Button(this.id+"-more",{type:"menu",menu:this.id+"-more-menu"});if(this.widgets.more.getMenu()){this.widgets.more.getMenu().subscribe("click",function(m,l){var n=l[1];if(n){switch(n.value){case"editSite":Alfresco.module.getEditSiteInstance().show({shortName:this.options.site});break;case"customiseSite":window.location=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.site+"/customise-site";break;case"leaveSite":var o=this;Alfresco.util.PopupManager.displayPrompt({title:o.msg("message.leave",o.options.siteTitle),text:o.msg("message.leave-site-prompt",o.options.siteTitle),buttons:[{text:o.msg("button.ok"),handler:function p(){o.leaveSite();this.destroy()}},{text:o.msg("button.cancel"),handler:function k(){this.destroy()},isDefault:true}]});break}}},this,true)}},joinSite:function e(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",dataObj:{role:"SiteConsumer",person:{userName:this.options.user}},successCallback:{fn:function k(){window.location.reload()},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},requestJoinSite:function a(){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/invitations",dataObj:{invitationType:"MODERATED",inviteeUserName:this.options.user,inviteeComments:"",inviteeRoleName:"SiteConsumer"},successCallback:{fn:this._requestJoinSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.request-join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request-joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},becomeSiteManager:function f(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",method:"POST",dataObj:{role:"SiteManager",person:{userName:this.options.user}},successCallback:{fn:this._becomeSiteManagerSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.become-manager-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.become-manager",this.options.siteTitle),spanClass:"wait",displayTime:0})},_becomeSiteManagerSuccess:function j(k){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.become-manager-success"),buttons:[{text:this.msg("button.ok"),handler:function l(){this.destroy();window.location.reload(true)},isDefault:true}]})},_requestJoinSuccess:function i(k){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.request-join-success",this.options.user,this.options.siteTitle),buttons:[{text:this.msg("button.ok"),handler:function l(){this.destroy();window.location=Alfresco.constants.URL_CONTEXT},isDefault:true}]})},leaveSite:function b(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships/"+encodeURIComponent(this.options.user),method:"DELETE",successCallback:{fn:function k(){window.location.href=Alfresco.constants.URL_CONTEXT},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.leave-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.leaving",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},_failureCallback:function g(l,k){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}if(k){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:k})}}})})();