<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>
 
<beans>
   
   <!-- Import the JodConverter extractor worker from the OOoJodconverter subsystem -->
   <bean id="extracter.worker.JodConverter"
         class="org.alfresco.repo.management.subsystems.SubsystemProxyFactory">
      <property name="sourceApplicationContextFactory">
         <ref bean="OOoJodconverter" />
      </property>
      <property name="sourceBeanName">
         <value>extracter.worker.JodConverter</value>
      </property>
      <property name="interfaces">
         <list>
            <value>org.alfresco.repo.content.metadata.OpenOfficeMetadataWorker</value>
         </list>
      </property>
   </bean>

   <!-- Metadata extractors -->
   <bean id="extracter.JodConverter"
         class="org.alfresco.enterprise.repo.content.metadata.JodConverterMetadataExtracter"
         parent="baseMetadataExtracter">
      <property name="worker">
         <ref bean="extracter.worker.JodConverter" />
      </property>
   </bean>



   <!-- Content transformers -->
   <bean id="transformer.complex.JodConverter.Image"
         class="org.alfresco.repo.content.transform.ComplexContentTransformer"
         parent="baseComplexContentTransformer" >
      <property name="transformers">
         <list>
            <ref bean="transformer.JodConverter.2Pdf" />
            <ref bean="transformer.complex.PDF.Image" />
         </list>
      </property>
      <property name="intermediateMimetypes">
         <list>
            <value>application/pdf</value>
         </list>
      </property>
      <!-- Note: there are maxSourceSizeKBytes limits on transformer.JodConverter transforming to pdf
           which may cause this transformer not to be selected because it is too slow. -->
   </bean>   

   <!-- Import the JodConverter transformer worker from the OOoJodconverter subsystem -->
   <bean id="transformer.worker.JodConverter"
         class="org.alfresco.repo.management.subsystems.SubsystemProxyFactory">
      <property name="sourceApplicationContextFactory">
         <ref bean="OOoJodconverter" />
      </property>
      <property name="sourceBeanName">
         <value>transformer.worker.JodConverter</value>
      </property>
      <property name="interfaces">
         <list>
            <value>org.alfresco.repo.content.transform.ContentTransformerWorker</value>
         </list>
      </property>
   </bean>

   <bean id="transformer.JodConverter"
         class="org.alfresco.repo.content.transform.ProxyContentTransformer"
         parent="baseContentTransformer">
      <property name="worker">
         <ref bean="transformer.worker.JodConverter" />
      </property>
      <property name="mimetypeLimits">
         <ref bean="transformer.OpenOffice.mimetypeLimits"/>
      </property>
      <property name="unsupportedTransformations">
         <list>
            <bean class="org.alfresco.repo.content.transform.SupportedTransformation" >
                <property name="sourceMimetype"><value>text/html</value></property>
                <property name="targetMimetype"><value>application/pdf</value></property>
            </bean>
         </list>
      </property>
   </bean>
   
   <bean id="transformer.complex.JodConverter.PdfBox"
         class="org.alfresco.repo.content.transform.ComplexContentTransformer"
         parent="baseComplexContentTransformer" >
      <property name="transformers">
         <list>
            <ref bean="transformer.JodConverter.2Pdf" />
            <ref bean="transformer.PdfBox" />
         </list>
      </property>
      <property name="intermediateMimetypes">
         <list>
            <value>application/pdf</value>
         </list>    
      </property>
      <property name="mimetypeLimits">
         <ref bean="transformer.complex.OpenOffice.PdfBox.mimetypeLimits"/>
      </property>
      <!-- Note: there are maxSourceSizeKBytes limits on transformer.JodConverter transforming to pdf
           which may cause this transformer not to be selected because it is too slow. -->
   </bean>

   <bean id="transformer.complex.JodConverter.Pdf2swf"
         class="org.alfresco.repo.content.transform.ComplexContentTransformer"
         parent="baseComplexContentTransformer" >
      <property name="transformers">
         <list>
            <ref bean="transformer.JodConverter.2Pdf" />
            <ref bean="transformer.Pdf2swf" />
         </list>
      </property>
      <property name="intermediateMimetypes">
         <list>
            <value>application/pdf</value>
         </list>
      </property>
      <property name="mimetypeLimits">
         <ref bean="transformer.complex.OpenOffice.Pdf2swf.mimetypeLimits"/>
      </property>
   </bean>

   <!--
    This transformer exists because OpenOffice and LibreOffice have a problem
    going directly from HTML to PDF. Going via ODT appears a much better option.
    For example <sub> tags hang the soffice process. ALF-14035 
     -->
   <bean id="transformer.JodConverter.2Pdf"
         class="org.alfresco.repo.content.transform.FailoverContentTransformer"
         parent="unregisteredBaseContentTransformer" >
     <property name="transformers">
        <list>
           <ref bean="transformer.JodConverter"/>
           <ref bean="transformer.JodConverter.Html2Pdf"/>
        </list>
     </property>  
      <property name="supportedTransformations">
         <list>
            <bean class="org.alfresco.repo.content.transform.SupportedTransformation" >
                <property name="targetMimetype"><value>application/pdf</value></property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="transformer.JodConverter.Html2Pdf"
         class="org.alfresco.repo.content.transform.ComplexContentTransformer"
         parent="baseComplexContentTransformer" >
      <property name="transformers">
         <list>
            <ref bean="transformer.JodConverter" />
            <ref bean="transformer.JodConverter" />
         </list>
      </property>
      <property name="intermediateMimetypes">
         <list>
            <value>application/vnd.oasis.opendocument.text</value>
         </list>
      </property>
      <property name="supportedTransformations">
         <list>
            <bean class="org.alfresco.repo.content.transform.SupportedTransformation" >
                <property name="sourceMimetype"><value>text/html</value></property>
                <property name="targetMimetype"><value>application/pdf</value></property>
            </bean>
         </list>
      </property>
      <property name="explicitTransformations">
         <list>
            <bean class="org.alfresco.repo.content.transform.ExplictTransformationDetails" >
                <property name="sourceMimetype"><value>text/html</value></property>
                <property name="targetMimetype"><value>application/pdf</value></property>
            </bean>
         </list>
      </property>
   </bean>

</beans>
